---
title: "Sierra Leone Teacher Pedagogy"
author: "GEPD Team"
execute:
  echo: false
  warning: false
format: docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	fig.height = 5,
	fig.width = 7,
  message=FALSE
)
library(tidyverse)
library(haven)
library(vtable)
library(here)
library(readxl)
library(stringr)
library(Hmisc)
library(naniar)
library(lubridate)
library(skimr)
library(digest)
library(validate)
library(GGally)
library(sf)
sf::sf_use_s2(FALSE)
library(ggthemes)
library(patchwork)
library(geojsonsf)
library(flextable)
library(srvyr)

#Country name
country <-'SLE'
country_name <- "Sierra Leone"
year <- '2022'

#########################
# File paths #
#########################
#The download_folder will be the location of where raw data is downloaded from the API
#The save_folder will be the location of where cleaned data is stored



if (str_to_lower(Sys.getenv("USERNAME")) == "wb469649" ){
  #project_folder  <- "//wbgfscifs01/GEDEDU/datalib-edu/projects/gepd"
  project_folder  <- "C:/Users/wb469649/WBG/HEDGE Files - HEDGE Documents/GEPD-Confidential/CNT/"
    download_folder <-file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/raw/School/", sep="/"))

  sampling_folder <-file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/sampling", sep="/"))
  confidential_folder <- file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/confidential/School", sep="/"))
  save_folder <- file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/anonymized/School", sep="/"))
  backup_onedrive="no"
  save_folder_onedrive <- file.path(paste("C:/Users/wb469649/WBG/Ezequiel Molina - Dashboard (Team Folder)/Country_Work/",country_name,year,"Data/clean/School", sep="/"))
  
} else if  (str_to_lower(Sys.getenv("USERNAME")) == "wb577189" ){
  #project_folder  <- "//wbgfscifs01/GEDEDU/datalib-edu/projects/gepd"
  project_folder  <- "C:/Users/wb577189/OneDrive - WBG/GEPD-Confidential/CNT/"
  download_folder <-file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/raw/School/INFRA", sep="/"))
  sampling_folder <-file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/sampling", sep="/"))
  confidential_folder <- file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/confidential/School", sep="/"))
  save_folder <- file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/anonymized/School", sep="/"))
  backup_onedrive="no"
  save_folder_onedrive <- file.path(paste("C:/Users/wb469649/WBG/Ezequiel Molina - Dashboard (Team Folder)/Country_Work/",country_name,year,"Data/clean/School", sep="/"))
  
}else {
  download_folder <- choose.dir(default = "", caption = "Select folder to open data downloaded from API")
  save_folder <- choose.dir(default = "", caption = "Select folder to save final data")

}


```

              |

In this document, summary statistics will be provided on teacher pedagogical practices using data from the GEPD survey that took place in 2022 in Sierra Leone

## Background on the GEPD survey in Sierra Leone

New data for the dashboard was collected using three main instruments: a School Survey, an Expert Survey, and a Survey of Public Officials. More information pertaining to each can be found below. The goal of the Global Education Policy Dashboard is to provide summary information at the national level on a set of 35 indicators and to allow countries to track progress on those indicators over a short time frame (every 2 years). Specifically, we aim to produce nationally representative estimates, which will be able to detect changes in the indicators over time at a minimum power of 80% and with a 0.05 significance level. We also wish to disaggregate by urban/rural.

School Survey: The School Survey collected data primarily on Practices (the quality of service delivery in schools), but also on some de facto Policy and school-level Politics indicators. It consists of streamlined versions of existing instruments—including SDI and SABER SD on teachers, 4th grade students, and inputs/infrastructure, TEACH on pedagogical practice, GECDD on school readiness of young children, and DWMS on management quality—together with new questions to fill gaps in those instruments. Though the number of modules is similar to the full version of SDI, the number of items within each module is significantly lower. In Sierra Leone, this survey was administered in a nationally representative sample of 270 schools, selected through stratified random sampling. 

Expert Survey: The Expert Survey collected information to feed into the policy indicators. This survey was filled out by key informants in Sierra Leone, drawing on their knowledge to identify key elements of the policy framework (as in the SABER approach to policy-data collection that the Bank has used over the past 7 years). The survey has 4 modules with each including approximately ten questions.

Survey of Public Officials: The Survey of Public Officials collected information about the capacity and orientation of the bureaucracy, as well as political factors affecting education outcomes. This survey was a streamlined and education-focused version of the civil-servant surveys that the Bank’s Bureaucracy Lab has implemented recently in several countries, and the dashboard team has collaborated closely with DEC and Governance GP staff to develop this instrument. The survey was administered to a random sample of about 200 staff serving in the central education ministry and district education offices. It includes questions about technical and leadership skills, work environment, stakeholder engagement, clientelism, and attitudes and behaviors.

## School Sample

About the EGRA/EGMA sampling frame:

> The sampling frame begun with the 2019 Annual School Census (ASC) list of primary schools as provided by UNICEF/MBSSE where the sample of 260 schools for this study were obtained from an initial list of 7,154 primary schools. Only schools that meet a pre-defined selection criteria were eligible for sampling.

> To achieve the recommended sample size of 10 learners per grade, schools that had an enrolment of at least 30 learners in Grade 2 in 2019 were considered. To achieve a high level of confidence in the findings and generate enough data for analysis, the selection criteria only considered schools that:
•	had an enrolment of at least 30 learners in grade 1; and
•	had an active grade 4 in 2019 (enrolment not zero)

> The sample was taken from a population of 4,597 primary schools that met the eligibility criteria above, representing 64.3% of all the 7,154 primary schools in Sierra Leone (as per the 2019 school census). Schools with higher numbers of learners were purposefully selected to ensure the sample size could be met in each site.

> As a result, a sample of 260 schools were drawn using proportional to size allocation with simple random sampling without replacement in each stratum. In the population, there were 16 districts and five school ownership categories (community, government, mission/religious, private and others). A total of 63 strata were made by forming combinations of  the 16 districts and school ownership categories. In each stratum, a sample size was computed proportional to the total population and samples were drawn randomly without replacement. Drawing from other EGRA/EGMA studies conducted by Montrose in the past, a backup sample of up to 78 schools (30% of the sample population) with which enumerator teams can replace sample schools was also be drawn. 

> In the distribution of sampled schools by ownership, majority of the sampled schools are owned by mission/religious group (62.7%, n=163) followed by the government owned schools at 18.5% (n=48). Additionally, in school distribution by district, majority of the sampled schools (54%) were found in Bo, Kambia, Kenema, Kono, Port Loko and Kailahun districts. Refer to annex 9. for details on the population and sample distribution by district.

Because of the restriction that at least 30 learners were available in Grade 2, we chose to add an additional 40 schools to the sample from among smaller schools, with between 3 and 30 grade 2 students.  The objective of this supplement was to make the sample more nationally representative, as the restriction reduced the sampling frame for the EGRA/EGMA sample by over 1,500 schools from 7,154 to 4,597.  

The 40 schools were chosen in a manner consistent with the original set of EGRA/EGMA schools. The 16 districts formed the strata. In each stratum, the number of schools selected were proportional to the total population of the statum, and within stratum schools were chosen with probability proportional to size.

```{r fun}



bin_var <- function(var, val) {
  case_when(
    var==val  ~ 1,
    var!=val   ~ 0,
    is.na(var) ~ as.numeric(NA))
}

bin_var_2 <- function(var, val) {
  if_else(var==val, 
          as.numeric(1),
          as.numeric(var))
}

bin_var_3 <- function(var, val) {
  case_when(
    var==val  ~ 1,
    TRUE   ~ 0
  )
}

df_weights_function <- function(dataset,scode, snumber, prov) {
  scode<-enquo(scode)  
  snumber<-enquo(snumber)
  prov<-enquo(prov)
  
  dataset %>%
    left_join(data_set_updated)  %>%
    mutate(province=idregion           ) 
}


```


```{r load}

#load the data
load(file.path(confidential_folder, "school_survey_data.RData"))

#Load original sample of schools
currentDate<-c("2022-10-07")
sample_folder <- file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_RAW", sep="_"),"Data/sampling/", sep="/"))
data_set_updated <- read_csv(paste(sample_folder, '/school_weights_revised_', currentDate,  '.csv', sep="")
) %>%
  mutate(ipw=case_when(
    is.na(ipw) ~ median(ipw, na.rm=TRUE),
    is.infinite(ipw) ~ median(ipw, na.rm=TRUE),
    TRUE ~ ipw)
    ) %>%
  ungroup() %>%
  mutate(school_code=idemis_code,
         urban_rural=if_else(accessibility=="Easily accessible", "Urban", "Rural"),
         private=if_else(sch_owner %in% c("Government", "Community"), "Public", "Private")) %>%
  select(school_code, sch_owner, idregion, iddistrict,accessibility,school_districthq_distance, urban_rural,sch_owner,private,egra_size,
         ipw) 







```

```{r schooldata}

school_analysis_df <- df_weights_function(final_school_data, Code_School, grd4_total, Region) %>%
  filter(!is.na(ipw))

```

Below is a map of the visited schools.

```{r map}
#| label: fig-map
#| fig-cap: Locations of Interviews for School Survey
#| fig-cap-location: top

wbgis <- "C:/Users/wb469649/WBG/HEDGE Files - HEDGE Documents/GEPD-Confidential/General/"



# load wb polygon data 

## import at district level (adm2 level)
wb.poly.2 <- geojson_sf(
  file.path(wbgis, "g2015_2014_2.geojson") # where _2 has district level polys
  ) %>%
  filter( ADM0_NAME == country_name) %>%
  distinct(ADM2_CODE,ADM1_CODE, ADM0_CODE, .keep_all = TRUE) 

school <- st_as_sf((school_analysis_df %>% filter( !is.na(lat)) ),
                   coords = c("lon", "lat"),
                   na.fail = FALSE)



# set the crs of school + po as the same as the world poly crs
st_crs(school) <- st_crs(wb.poly.2)

# st_is_longlat(Non_LIRE_school)
# st_is_longlat(LIRE_school)

school_map <- ggplot() +
  geom_sf(data=wb.poly.2) +
  geom_sf(data=school, color='#023047') +
  theme_map() +
  theme(legend.position='top') 

school_map

```

## Summary Statistics of Teach Scores

In each school, one classroom was randomly selected for the classroom observation.  

Summary statistics will be presented for all schools in Sierra Leone as well as by the urban/rural status of the schools.

Two scores will be shown. First, the average score of the teachers on the Teach (1-5) scale.  Second, the percentage of teachers who are rated as proficient on Teach, meaning the teacher scores at least 3 out of 5 points on the Teach (1-5) scale.

Summary statistics are weighted to be nationally representative.

```{r stats1}
#| label: tbl-measures
#| tbl-cap: Teacher Pedagogical Skill and Proficiency Metrics in Sierra Leone for All Schools


temp <- school_analysis_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private', 'urban_rural'),
                   weight=ipw) %>%
    summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T)) %>%
  mutate(across(everything(),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE'))

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof,
         
         ) %>%
  select(-value) %>%
  flextable() %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```

Below the statistics are broken down for urban/rural schools.  Urban and rural schools have similar Teach scores.

```{r stats2}
#| label: tbl-measures2
#| tbl-cap: Teacher Pedagogical Skill and Proficiency Metrics in Sierra Leone for Urban/Rural Schools


temp <- school_analysis_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(urban_rural) %>%
  summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T)) %>%
  mutate(across(!starts_with("urban_rural"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(urban_rural, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(urban_rural)

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof,
         `School Type`= urban_rural) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("School Type"),
          target=c("School Type")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```

```{r dens}
#| label: fig-measures2
#| fig-cap: Density plots of Teach Scores (1-5 scale) by Urban/Rural schools
#| fig-cap-location: top

ggplot(
  school_analysis_df, aes(x=teach_score, color=urban_rural)
) +
  geom_density() +
  theme_bw() +
  geom_vline(xintercept = 3) +
  xlab('Teach Score (1-5) scale') +
  expand_limits(x=c(1,5)) 

```


Next is a breakdown for the EGRA/non-EGRA schools.  EGRA schools, as described above, were relatively larger in size (at least 30 learners were available in Grade 2).  There do not appear to be large differences between the two groups of schools.

```{r stats52}
#| label: tbl-measures52
#| tbl-cap: Teacher Pedagogical Skill and Proficiency Metrics in Sierra Leone for EGRA/Non-EGRA Schools


temp <- school_analysis_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private','urban_rural'),
                   weight=ipw) %>%
  group_by(egra_size) %>%
  summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T)) %>%
  mutate(across(!starts_with("egra_size"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(egra_size, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(egra_size)

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof,
         `School EGRA`= egra_size) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("School EGRA"),
          target=c("School EGRA")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative.  The EGRA schools were schools that had at least 30 learners were available in Grade 2.') %>%
  autofit()


```

```{r}
#merge teacher selected to questionnaire
teacher_gender <- teacher_roster %>%
  select(interview__id, TEACHERS__id, m2saq3, m2saq4, m2saq5,m2saq5_other, m2saq6,starts_with('m2saq7'),starts_with('m2saq8'), subject_joined) %>%
  rename(m4saq1_number=TEACHERS__id)

school_analysis_merged_df <- df_weights_function(school_dta, Code_School, grd4_total, Region) %>%
  group_by(school_code) %>%
  fill(m4saq1_number, .direction = 'downup') %>%
  left_join(school_analysis_df %>% select(school_code, teach_score, teach_prof, instruction, instruction_prof, classroom_culture, classroom_culture_prof, socio_emotional_skills, socio_emotional_skills_prof)) %>%
  left_join(teacher_gender) %>%
  filter(!is.na(m4saq1_number)) %>%
  mutate(gender=if_else(m2saq3==1, "Male", "Female"),
         teacher_position=m2saq4,
         contract=case_when(
           m2saq5==1 ~ "Permanent",
           m2saq5==2 ~ "Contract",
           m2saq5==3 ~ "Temporary",
           m2saq5==4 ~ "Volunteer",
           TRUE ~ "Other"
         ),
         teacher_permanent=bin_var(m2saq5,1),
         teacher_contract=bin_var(m2saq5,2),
         teacher_temporary=bin_var(m2saq5,3),
         teacher_volunteer=bin_var(m2saq5,4),
         teacher_ngo=bin_var(m2saq5,5)==5,
         teacher_other=case_when(
           m2saq5==97 ~ m2saq5_other,
           m2saq5!=97 ~ "NA"
         ),
         teacher_fulltime=bin_var(m2saq6,1),
         teacher_time=case_when(
           m2saq6==1 ~ "Full Time",
           TRUE ~ "Part Time"
         ),
         teacher_male=bin_var(m2saq3,1),
         teacher_grd1=bin_var(m2saq7__1,1),
         teacher_grd2=bin_var(m2saq7__2,1),
         teacher_grd3=bin_var(m2saq7__3,1),
         teacher_grd4=bin_var(m2saq7__4,1),
         #teacher_grd5=bin_var(m2saq7__5,1),
         teacher_language=bin_var(m2saq8__1,1),
         teacher_math=bin_var(m2saq8__2,1),
         teacher_both_subj=bin_var(m2saq8__3,1),
         teacher_other_subj=bin_var(m2saq8__97,1)) %>%
  filter(gender=="Male" | gender=="Female")

#read in teach labels
teach_labels <- read_csv(paste0(here(),'/Data/Sierra Leone/2022/analysis/Teach_labels.csv' ))

subind <- final_indicator_data_PEDG %>%
  select(school_code, starts_with("s_"))

labels=c('School Code',teach_labels$label)
names(labels) <- c('school_code', teach_labels$variable)

labelled::var_label(subind) <- labels

#data to share
school_analysis_merged_df %>%
  left_join(subind) %>%
  select(colnames(data_set_updated),gender,colnames(subind ), starts_with('teach_'),
         starts_with('classroom_culture'),starts_with('instruction_'),starts_with('socio_emotional_skills')) %>%
  write_dta(path=paste0(save_folder, "/teach_analytical_file.dta"))





```

## Teacher Background

The following statistics breakdown the Teach overall score by Gender and other teacher background characteristics like the contract status, full/part-time status, and subject taught.



```{r stats21}
#| label: tbl-measures21
#| tbl-cap: Teacher Pedagogical Skill and Proficiency Metrics by Gender in Sierra Leone


temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(gender) %>%
  summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("urban_rural|gender"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(gender, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange( gender)

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c( "gender"),
          target=c( "gender")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```


Now by contract status.

```{r }

temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(contract) %>%
  summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("urban_rural|contract"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(contract, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange( contract)

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c( "contract"),
          target=c( "contract")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()



```

Now by full-time and Part-time status.

```{r}

temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(teacher_time) %>%
  summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("urban_rural|teacher_time"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(teacher_time, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange( teacher_time)

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c( "teacher_time"),
          target=c( "teacher_time")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()



```

Now by subject.

```{r }

temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(subject_joined) %>%
  summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("urban_rural|subject_joined"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(subject_joined, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange( subject_joined)

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c( "subject_joined"),
          target=c( "subject_joined")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()



```




```{r stats3}
#| label: tbl-measures3
#| tbl-cap: Teacher Pedagogical Skill and Proficiency Metrics by Gender in Sierra Leone for Urban/Rural Schools


temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(urban_rural, gender) %>%
  summarise(teachscore=survey_mean(teach_score, na.rm=T),
              teachprof=survey_mean(teach_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("urban_rural|gender"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(urban_rural, gender, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(urban_rural, gender)

stats %>%
  rename(`Teach Score (1-5 scale)`=teachscore,
         `Percentage of Teachers Proficient in Pedagogy`=teachprof,
         `School Type`= urban_rural) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("School Type", "gender"),
          target=c("School Type", "gender")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```

# Teach Subscores

The Teach instrument has three sub-scales.

![Teach Sub-scales](https://www.worldbank.org/content/dam/photos/780x439/2022/may/Picture6.jpg)

```{r stats1sub}
#| label: tbl-measuressib
#| tbl-cap: Teacher Pedagogical Subscore Metrics in Sierra Leone for All Schools


temp <- school_analysis_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private', 'urban_rural'),
                   weight=ipw) %>%
    summarise(instruction=survey_mean(instruction, na.rm=T),
              instruction_prof=survey_mean(instruction_prof, na.rm=T),
              classroom_culture=survey_mean(classroom_culture, na.rm=T),
              classroom_culture_prof=survey_mean(classroom_culture_prof, na.rm=T),
              socio_emotional_skills=survey_mean(socio_emotional_skills, na.rm=T),
              socio_emotional_skills_prof=survey_mean(socio_emotional_skills_prof, na.rm=T)) %>%
  mutate(across(everything(),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE'))

stats %>%
  rename(
         `Teach Instruction Score (1-5 scale)`=instruction,
         `Percentage of Teachers Proficient on Instruction`=instruction_prof,
         
         `Teach Classroom Culture Score (1-5 scale)`=classroom_culture,
         `Percentage of Teachers Proficient in Classroom Culture`=classroom_culture_prof,
         
         `Teach Socio-emotional Skills Score (1-5 scale)`=socio_emotional_skills,
         `Percentage of Teachers Proficient in Socio-emotional Skills`=socio_emotional_skills_prof) %>%
  select(-value) %>%
  flextable() %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```

Below the statistics are broken down for urban/rural schools.  

```{r stats2sub}
#| label: tbl-measures2sub
#| tbl-cap: Teacher Pedagogical Subscore Metrics in Sierra Leone for Urban/Rural Schools


temp <- school_analysis_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(urban_rural) %>%
  summarise(instruction=survey_mean(instruction, na.rm=T),
              instruction_prof=survey_mean(instruction_prof, na.rm=T),
              classroom_culture=survey_mean(classroom_culture, na.rm=T),
              classroom_culture_prof=survey_mean(classroom_culture_prof, na.rm=T),
              socio_emotional_skills=survey_mean(socio_emotional_skills, na.rm=T),
              socio_emotional_skills_prof=survey_mean(socio_emotional_skills_prof, na.rm=T)) %>%
  mutate(across(!starts_with("urban_rural"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(urban_rural, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(urban_rural)

stats %>%
  rename(
         `Teach Instruction Score (1-5 scale)`=instruction,
         `Percentage of Teachers Proficient on Instruction`=instruction_prof,
         
         `Teach Classroom Culture Score (1-5 scale)`=classroom_culture,
         `Percentage of Teachers Proficient in Classroom Culture`=classroom_culture_prof,
         
         `Teach Socio-emotional Skills Score (1-5 scale)`=socio_emotional_skills,
         `Percentage of Teachers Proficient in Socio-emotional Skills`=socio_emotional_skills_prof,
         `School Type`= urban_rural) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("School Type"),
          target=c("School Type")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```

By Gender

```{r stats3sub}
#| label: tbl-measures23sub
#| tbl-cap: Teacher Pedagogical Subscore Metrics by Gender in Sierra Leone


temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private', 'urban_rural'),
                   weight=ipw) %>%
  group_by(gender) %>%
  summarise(instruction=survey_mean(instruction, na.rm=T),
              instruction_prof=survey_mean(instruction_prof, na.rm=T),
              classroom_culture=survey_mean(classroom_culture, na.rm=T),
              classroom_culture_prof=survey_mean(classroom_culture_prof, na.rm=T),
              socio_emotional_skills=survey_mean(socio_emotional_skills, na.rm=T),
              socio_emotional_skills_prof=survey_mean(socio_emotional_skills_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("gender"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(gender, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(gender)

stats %>%
  rename(`Teach Instruction Score (1-5 scale)`=instruction,
         `Percentage of Teachers Proficient on Instruction`=instruction_prof,
         
         `Teach Classroom Culture Score (1-5 scale)`=classroom_culture,
         `Percentage of Teachers Proficient in Classroom Culture`=classroom_culture_prof,
         
         `Teach Socio-emotional Skills Score (1-5 scale)`=socio_emotional_skills,
         `Percentage of Teachers Proficient in Socio-emotional Skills`=socio_emotional_skills_prof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("gender"),
          target=c( "gender")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```



By Contract.

```{r stats3subc}
#| label: tbl-measures23sub2
#| tbl-cap: Teacher Pedagogical Subscore Metrics by Contract in Sierra Leone


temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'contract', 'urban_rural'),
                   weight=ipw) %>%
  group_by(contract) %>%
  summarise(instruction=survey_mean(instruction, na.rm=T),
              instruction_prof=survey_mean(instruction_prof, na.rm=T),
              classroom_culture=survey_mean(classroom_culture, na.rm=T),
              classroom_culture_prof=survey_mean(classroom_culture_prof, na.rm=T),
              socio_emotional_skills=survey_mean(socio_emotional_skills, na.rm=T),
              socio_emotional_skills_prof=survey_mean(socio_emotional_skills_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("contract"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(contract, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(contract)

stats %>%
  rename(`Teach Instruction Score (1-5 scale)`=instruction,
         `Percentage of Teachers Proficient on Instruction`=instruction_prof,
         
         `Teach Classroom Culture Score (1-5 scale)`=classroom_culture,
         `Percentage of Teachers Proficient in Classroom Culture`=classroom_culture_prof,
         
         `Teach Socio-emotional Skills Score (1-5 scale)`=socio_emotional_skills,
         `Percentage of Teachers Proficient in Socio-emotional Skills`=socio_emotional_skills_prof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("contract"),
          target=c( "contract")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```


By full-time and part-time.

```{r stats3subf}
#| label: tbl-measures23sub3
#| tbl-cap: Teacher Pedagogical Subscore Metrics by Full/Part Time in Sierra Leone


temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'teacher_time', 'urban_rural'),
                   weight=ipw) %>%
  group_by(teacher_time) %>%
  summarise(instruction=survey_mean(instruction, na.rm=T),
              instruction_prof=survey_mean(instruction_prof, na.rm=T),
              classroom_culture=survey_mean(classroom_culture, na.rm=T),
              classroom_culture_prof=survey_mean(classroom_culture_prof, na.rm=T),
              socio_emotional_skills=survey_mean(socio_emotional_skills, na.rm=T),
              socio_emotional_skills_prof=survey_mean(socio_emotional_skills_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("teacher_time"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(teacher_time, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(teacher_time)

stats %>%
  rename(`Teach Instruction Score (1-5 scale)`=instruction,
         `Percentage of Teachers Proficient on Instruction`=instruction_prof,
         
         `Teach Classroom Culture Score (1-5 scale)`=classroom_culture,
         `Percentage of Teachers Proficient in Classroom Culture`=classroom_culture_prof,
         
         `Teach Socio-emotional Skills Score (1-5 scale)`=socio_emotional_skills,
         `Percentage of Teachers Proficient in Socio-emotional Skills`=socio_emotional_skills_prof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("teacher_time"),
          target=c( "teacher_time")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```

By subject taught.

```{r stats3subs}
#| label: tbl-measures23sub4
#| tbl-cap: Teacher Pedagogical Subscore Metrics by Subject in Sierra Leone


temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'subject_joined', 'urban_rural'),
                   weight=ipw) %>%
  group_by(subject_joined) %>%
  summarise(instruction=survey_mean(instruction, na.rm=T),
              instruction_prof=survey_mean(instruction_prof, na.rm=T),
              classroom_culture=survey_mean(classroom_culture, na.rm=T),
              classroom_culture_prof=survey_mean(classroom_culture_prof, na.rm=T),
              socio_emotional_skills=survey_mean(socio_emotional_skills, na.rm=T),
              socio_emotional_skills_prof=survey_mean(socio_emotional_skills_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("subject_joined"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(subject_joined, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(subject_joined)

stats %>%
  rename(`Teach Instruction Score (1-5 scale)`=instruction,
         `Percentage of Teachers Proficient on Instruction`=instruction_prof,
         
         `Teach Classroom Culture Score (1-5 scale)`=classroom_culture,
         `Percentage of Teachers Proficient in Classroom Culture`=classroom_culture_prof,
         
         `Teach Socio-emotional Skills Score (1-5 scale)`=socio_emotional_skills,
         `Percentage of Teachers Proficient in Socio-emotional Skills`=socio_emotional_skills_prof) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("subject_joined"),
          target=c( "subject_joined")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```

```{r stats3sub}
#| label: tbl-measures3sub
#| tbl-cap: Teacher Pedagogical Subscore Metrics by Gender in Sierra Leone for Urban/Rural Schools

temp <- school_analysis_merged_df %>%
  ungroup() %>%
  as_survey_design(strata=c('province', 'private'),
                   weight=ipw) %>%
  group_by(urban_rural, gender) %>%
  summarise(instruction=survey_mean(instruction, na.rm=T),
              instruction_prof=survey_mean(instruction_prof, na.rm=T),
              classroom_culture=survey_mean(classroom_culture, na.rm=T),
              classroom_culture_prof=survey_mean(classroom_culture_prof, na.rm=T),
              socio_emotional_skills=survey_mean(socio_emotional_skills, na.rm=T),
              socio_emotional_skills_prof=survey_mean(socio_emotional_skills_prof, na.rm=T),
            N=n()) %>%
  mutate(across(!matches("urban_rural|gender"),round,2)) %>%
  mutate(across(ends_with('_se'), ~paste0('(',.,')'))) %>%
  mutate(across(everything(),as.character))


stats <- (temp %>% select(!ends_with('_se')) %>% mutate(value='Mean')) %>%
  bind_rows(temp %>% select(urban_rural, gender, ends_with('_se'))  %>% rename_all(str_remove,"_se") %>% mutate(value='SE')) %>%
  arrange(urban_rural, gender)

stats %>%
  rename(`Teach Instruction Score (1-5 scale)`=instruction,
         `Percentage of Teachers Proficient on Instruction`=instruction_prof,
         
         `Teach Classroom Culture Score (1-5 scale)`=classroom_culture,
         `Percentage of Teachers Proficient in Classroom Culture`=classroom_culture_prof,
         
         `Teach Socio-emotional Skills Score (1-5 scale)`=socio_emotional_skills,
         `Percentage of Teachers Proficient in Socio-emotional Skills`=socio_emotional_skills_prof,
         `School Type`= urban_rural) %>%
  select(-value) %>%
  flextable() %>%
  merge_v(j=c("School Type", "gender"),
          target=c("School Type", "gender")) %>%
  add_footer_lines('Note: 95% confidence interval in parenthesis.  Estimates weighted to be nationally representative') %>%
  autofit()


```
