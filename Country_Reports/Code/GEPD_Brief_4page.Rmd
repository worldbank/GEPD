---
output:
  pdf_document:
    latex_engine: pdflatex
    fig_caption: yes
    keep_tex: yes
documentclass: article
classoption: twocolumn
geometry: "left=0.5cm,right=0.5cm,top=1.5cm,bottom=1.2cm"
header-includes: \usepackage{fancyhdr}
  \usepackage{booktabs,xcolor}
  \pagestyle{fancy}
  \renewcommand{\headrulewidth}{0pt}
  \rhead{2019}
  \fancypagestyle{plain}{\pagestyle{fancy}}  
  \setlength{\headheight}{77.3pt}
  \setlength{\footskip}{35.1pt}
  \setlength{\textheight}{0.90\textheight}
  \pagenumbering{gobble}
  \usepackage[fontsize=9pt]{scrextend}
  \usepackage{float}
  \restylefloat{table}
  \usepackage{xcolor}
  \usepackage{multicol}
  \usepackage{array}
  \usepackage{colortbl}
  \usepackage{multirow}
  \usepackage{collcell}
  \usepackage{setspace}
  \usepackage{arydshln}  
  \usepackage{caption}
  \captionsetup{skip=0pt}
  \setlength{\columnsep}{1.5cm}
  \setstretch{1}
  
---
\newcommand{\greynote}[1]{
    {\scriptsize
    \textcolor{darkgray}{\textit{Source:} #1}
  }
}

\newcommand{\greysource}[1]{
    {\scriptsize
    \textcolor{darkgray}{\textit{Source:} #1}
  }
}

\newcommand{\greydisclaimer}[1]{
    {\scriptsize
    \textcolor{darkgray}{\textit{Disclaimer:} #1}
  }
}

\newcommand{\greytext}[1]{
    {\scriptsize
    \textcolor{darkgray}{#1}
  }
}

\newcommand*{\tabindent}{\hspace{1mm}}

```{r setup, include=FALSE}
#include packages
library(tidyverse)
library(haven)
library(dplyr, warn.conflicts = FALSE)
library(tidyr)
library(stringr)
library(scales)
library(readxl)
library(glue)
library(httr)
library(jsonlite)
library(wbstats)
library(ggrepel)
library(here)
#########################
# Launch Code
########################
#move working directory to github main folder
#anchor directory to correct place
here()
setwd(here())

#load API file
input <- read_csv(paste("./Data/GEPD_Indicators_API_",country_file_name,".csv",sep=""))
#Modify file to add indicator labels for de-facto de-jure comparison indicators required
input <- input %>%
  mutate(value = if_else(value<=5.5, round(value, digits = 1), round(value, digits = 0))) %>%
  mutate(label = case_when(
Series == "SE.PRM.SATT" ~ "Management-Attraction",
Series == "SE.PRM.SCFN" ~ "Management-Clarity of functions",
Series == "SE.PRM.SEVL" ~ "Management-Evaluation",
Series == "SE.PRM.SSLD" ~ "Management- Selection & Deployment",
Series == "SE.PRM.SSUP" ~ "Management- Support",
Series == "SE.PRM.TSUP" ~ "Teaching - Support",
Series == "SE.PRM.TATT" ~ "Teaching- Attraction",
Series == "SE.PRM.TEVL" ~ "Teaching- Evaluation",
Series == "SE.PRM.TINM" ~ "Teaching- Intrinsic Motivation",
Series == "SE.PRM.TMNA" ~ "Teaching - Monitoring & Accountability",
Series == "SE.PRM.TSDP" ~ "Teaching - Selection & Deployment",
Series == "SE.PRM.SATT.DJ" ~ "Management-Attraction",
Series == "SE.PRM.SCFN.DJ" ~ "Management-Clarity of functions",
Series == "SE.PRM.SEVL.DJ" ~ "Management-Evaluation",
Series == "SE.PRM.SSLD.DJ" ~ "Management- Selection & Deployment",
Series == "SE.PRM.SSUP.DJ" ~ "Management- Support",
Series == "SE.PRM.TSUP.DJ" ~ "Teaching - Support",
Series == "SE.PRM.TATT.DJ" ~ "Teaching- Attraction",
Series == "SE.PRM.TEVL.DJ" ~ "Teaching- Evaluation",
Series == "SE.PRM.TINM.DJ" ~ "Teaching- Intrinsic Motivation",
Series == "SE.PRM.TMNA.DJ" ~ "Teaching - Monitoring & Accountability",
Series == "SE.PRM.TSDP.DJ" ~ "Teaching - Selection & Deployment",
Series == "SE.PRM.SATT.2" ~ "Salary (as % GDP per capita) score (0-5 scale)",
Series == "SE.PRM.SATT.3" ~ "% principals satisfied with their social status",
Series == "SE.PRM.SCFN.1" ~ "Infrastructure",
Series == "SE.PRM.SCFN.11" ~ "Principal hiring or assignment",
Series == "SE.PRM.SCFN.13" ~ "Principal supervision or training",
Series == "SE.PRM.SCFN.3" ~ "Material procurement",
Series == "SE.PRM.SCFN.5" ~ "Teacher hiring or assignment",
Series == "SE.PRM.SCFN.7" ~ "Teacher supervision or training",
Series == "SE.PRM.SCFN.9" ~ "Student assessments",
Series == "SE.PRM.SEVL.3" ~ "Report being evalauted",
Series == "SE.PRM.SEVL.4" ~ "Report evaluation on multiple factors",
Series == "SE.PRM.SEVL.5" ~ "Report consequences post negative evaluations",
Series == "SE.PRM.SEVL.6" ~ "Report benefits post positive evaluations",
Series == "SE.PRM.SSLD.10" ~ "Report most important- Experience",
Series == "SE.PRM.SSLD.11" ~ "Report most important- Teaching quality",
Series == "SE.PRM.SSLD.12" ~ "Report most important- Management quality",
Series == "SE.PRM.SSLD.13" ~ "Report most important- Relationship with school owner ",
Series == "SE.PRM.SSLD.14" ~ "Report most important- Political affiliation",
Series == "SE.PRM.SSLD.15" ~ "Report most important- Ethnicity",
Series == "SE.PRM.SSLD.16" ~ "Report most important- Local community knowledge",
Series == "SE.PRM.SSLD.3" ~ "Report experience counts",
Series == "SE.PRM.SSLD.4" ~ "Report teaching quality counts",
Series == "SE.PRM.SSLD.5" ~ "Report management quality counts",
Series == "SE.PRM.SSLD.6" ~ "Report relationship with school owner counts",
Series == "SE.PRM.SSLD.7" ~ "Rpeort political affiliation counts",
Series == "SE.PRM.SSLD.8" ~ "Report ethnicity counts",
Series == "SE.PRM.SSLD.9" ~ "Report local community knowledge counts",
Series == "SE.PRM.SSUP.10" ~ "Used training skills",
Series == "SE.PRM.SSUP.6" ~ "Received formal training",
Series == "SE.PRM.SSUP.7" ~ "Received management training upon joining",
Series == "SE.PRM.SSUP.8" ~ "Received in-service training",
Series == "SE.PRM.SSUP.9" ~ "Received mentorship",
Series == "SE.PRM.TATT.2" ~ "Satisfied with social status",
Series == "SE.PRM.TATT.3" ~ "Satisfied with job",
Series == "SE.PRM.TATT.4" ~ "Received financial bonus",
Series == "SE.PRM.TATT.5" ~ "Report incentives exist to teach certain subjects/grades",
Series == "SE.PRM.TATT.6" ~ "Report performance counts for promotions",
Series == "SE.PRM.TATT.8" ~ "Faced salary delays",
Series == "SE.PRM.TEVL.3" ~ "Report being evalauted",
Series == "SE.PRM.TEVL.6" ~ "Report consequences post negative evaluations",
Series == "SE.PRM.TEVL.7" ~ "Report benefits post positive evaluations",
Series == "SE.PRM.TINM.1" ~ "% teachers- can be absent if curriculum complete",
Series == "SE.PRM.TINM.10" ~ "% teachers- believe students can change intelligence",
Series == "SE.PRM.TINM.11" ~ "% teachers-intrinsic motivation for career",
Series == "SE.PRM.TINM.12" ~ "% teachers- report compulsory probation period",
Series == "SE.PRM.TINM.2" ~ "% teachers- can be absent if students have work",
Series == "SE.PRM.TINM.3" ~ "% teachers- can be absent if teacher is doing useful work",
Series == "SE.PRM.TINM.4" ~ "% teachers- students deserve attention based on attendance",
Series == "SE.PRM.TINM.5" ~ "% teachers- students deserve attention if they have materials",
Series == "SE.PRM.TINM.6" ~ "% teachers- students deserve attention based on motivation",
Series == "SE.PRM.TINM.7" ~ "% teachers- students limited in attempt to change intelligence",
Series == "SE.PRM.TINM.8" ~ "% teachers- students cannot change intelligence",
Series == "SE.PRM.TINM.9" ~ "% teachers- students can change intelligence",
Series == "SE.PRM.TMNA.3" ~ "Report receiving monetary incentive for attendance",
Series == "SE.PRM.TMNA.4" ~ "Reported absence due to administrative work",
Series == "SE.PRM.TMNA.5" ~ "Report consequences exist for 40% absence",
Series == "SE.PRM.TSDP.2" ~ "Average quality of teaching applicants accepted into initial education programs (0-100 Scale)",
Series == "SE.PRM.TSDP.4" ~ "Teacher selection criteria score(0-2 scale)",
Series == "SE.PRM.TSDP.6" ~ "Teacher transfer request criteria score (0-2 scale)",
Series == "SE.PRM.TSUP.2" ~ "Completed practicum",
Series == "SE.PRM.TSUP.3" ~ "Participated in induction/mentorship program",
Series == "SE.PRM.TSUP.5" ~ "Attended in-service training recently",
Series == "SE.PRM.TSUP.8" ~ "% time spent in classrooms during trainings",
Series == "SE.PRM.TSUP.9" ~ "Have opportunities to share ways to improve teaching with other teachers")
)

##########
# Pull Ed Stats Data using World Bank API
##########
# make request to World Bank API and get a list of all EdStats indicators (including learning poverty)
EdStatsRequest <- GET(url = "http://api.worldbank.org/v2/indicator?per_page=20000&format=json&source=12")
EdStatsResponse <- content(EdStatsRequest, as = "text", encoding = "UTF-8")

# Parse the JSON content and convert it to a data frame.
EdStatsJSON <- fromJSON(EdStatsResponse, flatten = TRUE) %>%
  data.frame()

# Create a list of indicators to pull from edstats. More can be added as needed
learning_pov_indicators<- 'SE.LPV.PRIM' # Pupils below minimum reading proficiency at end of primary (%). Low GAML threshold

#get WDI metadata infor
cache_list<-wbstats::wbcache()
country_list <- wbstats::wbcountries()

#get region and income group of the country
region_label <- country_list[which(country_list$iso3c==country_file_name),]$admin
income_label <- country_list[which(country_list$iso3c==country_file_name),]$income
country_label <- country
#set reference year to 2019 (Year of survey)
reference_year<-as.numeric(year)

# Now use wbstats package in R to pull from World Bank API

learning_poverty_df <-wbstats::wb(country="all", #by specifying all, we can get a list of all aggregates (such as region or income level)
                     indicator=learning_pov_indicators,
                     startdate=reference_year-10,
                     enddate=reference_year,
                     return_wide = T,
                     removeNA=TRUE,
                     cache = cache_list
                     ) %>%
    filter(((reference_year-as.numeric(date))<=10) & (reference_year>=as.numeric(date))) %>% #filter out years outside reference window of 10 years     
    group_by(iso3c, country) %>%
    filter(as.numeric(date)==max(as.numeric(date))) %>% #group by country to create one observation per country which is the latest value
      mutate(tab = 0 , 
           SE.LPV.PRIM = as.numeric(SE.LPV.PRIM),
           ID = case_when(country %in% c(country_label,region_label,income_label) ~ iso3c,
                          TRUE ~ as.character(NA)),
           grx = SE.LPV.PRIM/100)
```

### **INTRODUCTION** ###  
**The Global Education Policy Dashboard (GEPD): An innovative tool to measure drivers of learning outcomes in basic education**  
GEPD uses 3 data collection instruments to report on nearly 40 indicators that operationalize the World Development Report 2018 framework to track 3 areas for progress in education- Practices, Policies, and Politics. Using these indicators, the dashboard highlights areas where countries need to act to improve learning outcomes and allows a way for governments to track progress as they act to close gaps in these areas. For more information on GEPD, please visit **[www.worldbank.org/global-education-policy-dashboard](https://www.worldbank.org/en/topic/education/brief/global-education-policy-dashboard)**  

#### Figure 1. GEPD framework (practices, policies and politics), expanding on WDR 2018 framework ####
```{r out.width = "80%", fig.align = "center", echo=FALSE}
figure1a <- paste(here(),"/Data/full_circle.png", sep="")
knitr::include_graphics(figure1a)
```
### **INSTRUMENTS OF DATA** ###  
The **School Survey** consists of 8 modules to collect data across 200-300 schools on practices (the quality of service delivery in schools) and de facto policy indicators. It consists of streamlined versions of existing instruments together with new questions to fill gaps in those instruments.  
The **Policy Survey** collects information via interviews with ~200 officials per country at federal and regional level to feed into the policy de jure indicators and identify key elements of the policy framework.  
The **Survey of public officials** collects information about the capacity and orientation of the bureaucracy and political factors affecting education outcomes. This survey is an education-focused version of the civil-servant surveys from the Bureaucracy Lab, WBG.  

### **KEY TAKEAWAYS, `r country_uc`, `r year`** ###  

`r paste(takeaway)`

```{r color_codes, echo=FALSE, message = FALSE, warning = FALSE}

grep_color <- c('PROE|TENR|PRIM|ATTD|CONT|EFFT|LCAP|PEDG|LERN')

 input <- input %>%
    as_tibble(.name_repair = 'universal') %>%
   #Adding new cell with value and colour in new column
    mutate(value_color=case_when(
      #percentages
      (value >=80 &            (grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{green!15}",value,sep=""),
      (value >=60 & value<80 & (grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{yellow!15}",value, sep=""),
      (value <60 &             (grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{red!15}",value, sep=""),
      #non-percentages
      (value >=4 & value<=5 &  !(grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{green!15}",value, sep=""),
      (value >=3 & value<4 &   !(grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{yellow!15}",value, sep=""),
      (value <3 &              !(grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{red!15}",value, sep="")
    )
    ) %>%
   #Adding new cell with only colour in new column
    mutate(only_color=case_when(
      #percentages
      (value >=80 &            (grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{green!15}"),
      (value >=60 & value<80 & (grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{yellow!15}"),
      (value <60 &             (grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{red!15}"),
      #non-percentages
      (value >=4 & value<=5 &  !(grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{green!15}"),
      (value >=3 & value<4 &   !(grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{yellow!15}"),
      (value <3 &              !(grepl(grep_color, Series) | grepl('Percent', Indicator.Name))) ~ paste("\\cellcolor{red!15}")
    )
    )
```
\setlength\dashlinedash{0.2pt}
\setlength\dashlinegap{1.5pt}
\setlength\arrayrulewidth{0.3pt}
\definecolor{outcome}{RGB}{231, 128, 65}
\definecolor{practice}{RGB}{69, 164, 211}
\definecolor{policy}{RGB}{37, 117, 186}
\definecolor{politics}{RGB}{0, 35, 69}

#### Table 1. GEPD Indicators, `r country`, `r year` ####
\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{cm{2cm}m{5cm}c}
& \textbf{Subtitle} & \textbf{Indicator} & \textbf{Overall} \\ \hline
\cellcolor{outcome} & \multirow{3}{2cm}{Learning} & Proficiency by Grade 2/3       & {`r input$value_color[input$Series=="SE.PRM.PROE"]`\%} \\\cdashline{3-4}
\cellcolor{outcome} &                             & Proficiency by End of Primary  & {`r input$value_color[input$Series=="SE.PRM.PROP"]`\%} \\\cdashline{3-4}
\cellcolor{outcome} &                             & Proficiency on GEPD Assessment & {`r input$value_color[input$Series=="SE.PRM.LERN"]`\%} \\\cdashline{2-4}
\cellcolor{outcome} &  Participation              & Net Adjusted Enrollment Rate   & {`r input$value_color[input$Series=="SE.PRM.PART"]`\%} \\\cdashline{2-4}
\cellcolor{outcome}\multirow{-5}{*}{\rotatebox{90}{\textcolor{white}{Outcomes}}} &  Participation and learning  & Learning Poverty Rate & {`r input$value_color[input$Series=="SE.LPV.PRIM"]`\%} \\\cdashline{1-4}
\cellcolor{practice} & \multirow{3}{2cm}{Teaching}                 & Teacher Effort           & {`r input$value_color[input$Series=="SE.PRM.EFFT"]`\%} \\\cdashline{3-4}
\cellcolor{practice} &                                             & Content Knowledge        & {`r input$value_color[input$Series=="SE.PRM.CONT"]`\%} \\\cdashline{3-4}
\cellcolor{practice} &                                             & Pedagogical Skills       & {`r input$value_color[input$Series=="SE.PRM.PEDG"]`\%} \\\cdashline{2-4}
\cellcolor{practice} & \multirow{2}{2cm}{Inputs \& Infrastructure} & Basic Inputs             & `r input$value_color[input$Series=="SE.PRM.INPT"]` \\\cdashline{3-4}
\cellcolor{practice} &                                             & Basic Infrastructure     & `r input$value_color[input$Series=="SE.PRM.INFR"]` \\\cdashline{2-4}
\cellcolor{practice} & \multirow{2}{2cm}{Learners}                 & Capacity for Learning    & {`r input$value_color[input$Series=="SE.PRM.LCAP"]`\%} \\\cdashline{3-4}
\cellcolor{practice} &                                             & Student Attendance       & {`r input$value_color[input$Series=="SE.PRM.ATTD"]`\%} \\\cdashline{2-4}
\cellcolor{practice} & \multirow{4}{2cm}{School Management}        & Operational Management   & `r input$value_color[input$Series=="SE.PRM.OPMN"]` \\\cdashline{3-4}
\cellcolor{practice} &                                             & Instructional Leadership & `r input$value_color[input$Series=="SE.PRM.ILDR"]` \\\cdashline{3-4}
\cellcolor{practice} &                                             & School Knowledge         & `r input$value_color[input$Series=="SE.PRM.PKNW"]` \\\cdashline{3-4}
\cellcolor{practice}\multirow{-13}{*}{\rotatebox{90}{\textcolor{white}{Practices}}}  & & Management Practices  & `r input$value_color[input$Series=="SE.PRM.PMAN"]` \\\cdashline{1-4}
\cellcolor{policy}   & \multirow{6}{2cm}{Teaching}                  & Attraction                    & `r input$value_color[input$Series=="SE.PRM.TATT"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Selection \& Deployment       & `r input$value_color[input$Series=="SE.PRM.TSDP"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Support                       & `r input$value_color[input$Series=="SE.PRM.TSUP"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Evaluation                    & `r input$value_color[input$Series=="SE.PRM.TEVL"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Monitoring \& Accountability  & `r input$value_color[input$Series=="SE.PRM.TMNA"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Intrinsic Motivation          & `r input$value_color[input$Series=="SE.PRM.TINM"]` \\\cdashline{2-4}
\cellcolor{policy}   & \multirow{2}{2cm}{Inputs \& infrastructure}  & Standards                     & `r input$value_color[input$Series=="SE.PRM.ISTD"]` \\\cdashline{3-4} 
\cellcolor{policy}   &                                              & Monitoring                    & `r input$value_color[input$Series=="SE.PRM.IMON"]` \\\cdashline{2-4}
\cellcolor{policy}   & \multirow{5}{2cm}{Learners}                  & Nutrition Programs            & `r input$value_color[input$Series=="SE.PRM.TATT"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Health Programs               & `r input$value_color[input$Series=="SE.PRM.TATT"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Center based care             & `r input$value_color[input$Series=="SE.PRM.LCBC"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Caregiver Financial Capacity  & `r input$value_color[input$Series=="SE.PRM.LCBC"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Caregiver Skills Capacity     & `r input$value_color[input$Series=="SE.PRM.LSKC"]` \\\cdashline{2-4}
\cellcolor{policy}   & \multirow{5}{2cm}{School Management}         & Clarity of Functions          & `r input$value_color[input$Series=="SE.PRM.SCFN"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Attraction                    & `r input$value_color[input$Series=="SE.PRM.SATT"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Selection \& Deployment       & `r input$value_color[input$Series=="SE.PRM.SSLD"]` \\\cdashline{3-4}
\cellcolor{policy}   &                                              & Support                       & `r input$value_color[input$Series=="SE.PRM.SSUP"]` \\\cdashline{3-4}
\cellcolor{policy}\multirow{-18}{*}{\rotatebox{90}{\textcolor{white}{Policy levers}}} & & Evaluation           & `r input$value_color[input$Series=="SE.PRM.SEVL"]` \\\cdashline{1-4}
\cellcolor{politics} & \multirow{5}{2cm}{Politics \& Bureaucratic Capacity}           & Quality of Bureaucracy & `r input$value_color[input$Series=="SE.PRM.TATT"]` \\\cdashline{3-4}
\cellcolor{politics} & & Impartial Decision-Making  & `r input$value_color[input$Series=="SE.PRM.TSDP"]` \\\cdashline{3-4}
\cellcolor{politics} & & Mandates \& Accountability & `r input$value_color[input$Series=="SE.PRM.TSUP"]` \\\cdashline{3-4}
\cellcolor{politics} & & National Learning Goals    & `r input$value_color[input$Series=="SE.PRM.TEVL"]` \\\cdashline{3-4}
\cellcolor{politics}\multirow{-5}{*}{\rotatebox{90}{\textcolor{white}{Politics}}}     & & Financing            & `r input$value_color[input$Series=="SE.PRM.TMNA"]` \\\hline
\end{tabular}}
\\
\greysource{UIS, GLAD, GEPD, World Bank, `r country`, `r year`. For information on indicators, please consult the World Bank \href{https://github.com/worldbank/GEPD}{\underline{GEPD}}, \href{https://github.com/worldbank/GLAD}{\underline{GLAD}} and \href{https://github.com/worldbank/LearningPoverty}{\underline{Learning Poverty}} repositories.}\\
\greynote{All indicators are on a scale of 0-5 unless measured in \%. Green indicates indicator 'on-target', yellow indicates 'requires caution', red indicates 'needs improvement'}
\end{table}
\vfill\null

#### Table 2. GEPD Indicators by gender, `r country`, `r year` ####
\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{m{2cm}m{5cm}cc}
\textbf{Subtitle} & \textbf{Indicator} & \textbf{Male} & \textbf{Female} \\ \hline
Learning                  & Proficiency on GEPD Assessment  & {`r input$value_color[input$Series=="SE.PRM.LERN.1.M"]`\%} & {`r input$value_color[input$Series=="SE.PRM.LERN.1.F"]`\%} \\\cdashline{1-4}
\multirow{3}{*}{Teaching} & Teacher Effort      & {`r input$value_color[input$Series=="SE.PRM.EFFT.1.M"]`\%} & {`r input$value_color[input$Series=="SE.PRM.EFFT.1.F"]`\%} \\\cdashline{2-4}
                          &  Content knowledge  & {`r input$value_color[input$Series=="SE.PRM.CONT.1.M"]`\%} & {`r input$value_color[input$Series=="SE.PRM.CONT.1.F"]`\%} \\\cdashline{2-4}
                          &  Pedagogical Skills & {`r input$value_color[input$Series=="SE.PRM.PEDG.1.M"]`\%} & {`r input$value_color[input$Series=="SE.PRM.PEDG.1.F"]`\%} \\\cdashline{1-4}
\multirow{2}{*}{Learners}   & Capacity for Learning    & {`r input$value_color[input$Series=="SE.PRM.LCAP.1.M"]`\%} & {`r input$value_color[input$Series=="SE.PRM.LCAP.1.F"]`\%} \\\cdashline{2-4}
                            & Student Attendance       & {`r input$value_color[input$Series=="SE.PRM.ATTD.1.M"]`\%} & {`r input$value_color[input$Series=="SE.PRM.ATTD.1.F"]`\%} \\\cdashline{1-4}
\multirow{4}{2cm}{School Management}  & Operational Management   & `r input$value_color[input$Series=="SE.PRM.OPMN.1.M"]` & `r input$value_color[input$Series=="SE.PRM.OPMN.1.F"]` \\\cdashline{2-4}
                                      & Instructional Leadership & `r input$value_color[input$Series=="SE.PRM.ILDR.1.M"]` & `r input$value_color[input$Series=="SE.PRM.ILDR.1.F"]` \\\cdashline{2-4}
                                      & School Knowledge         & `r input$value_color[input$Series=="SE.PRM.PKNW.1.M"]` & `r input$value_color[input$Series=="SE.PRM.PKNW.1.F"]` \\\cdashline{2-4}
                                      & Management Practices     & `r input$value_color[input$Series=="SE.PRM.PMAN.1.M"]` & `r input$value_color[input$Series=="SE.PRM.PMAN.1.F"]`\\\hline
\end{tabular}}
\end{table}

#### Table 3. GEPD Indicators by region, `r country`, `r year` ####
\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{m{2cm}m{5cm}cc}
\textbf{Subtitle} & \textbf{Indicator} & \textbf{Rural} & \textbf{Urban} \\ \hline
Learning                  & Proficiency on GEPD Assessment & {`r input$value_color[input$Series=="SE.PRM.LERN.1.R"]`\%} & {`r input$value_color[input$Series=="SE.PRM.LERN.1.U"]`\%} \\\cdashline{1-4}
\multirow{3}{*}{Teaching} & Teacher Effort                 & {`r input$value_color[input$Series=="SE.PRM.EFFT.1.R"]`\%} & {`r input$value_color[input$Series=="SE.PRM.EFFT.1.U"]`\%} \\\cdashline{2-4}
                          &  Content knowledge             & {`r input$value_color[input$Series=="SE.PRM.CONT.1.R"]`\%} & {`r input$value_color[input$Series=="SE.PRM.CONT.1.U"]`\%} \\\cdashline{2-4}
                          &  Pedagogical Skills            & {`r input$value_color[input$Series=="SE.PRM.PEDG.1.R"]`\%} & {`r input$value_color[input$Series=="SE.PRM.PEDG.1.U"]`\%} \\\cdashline{1-4}
\multirow{2}{2cm}{Inputs \& infrastructure}   & Basic Inputs             & `r input$value_color[input$Series=="SE.PRM.INPT.1.R"]` & `r input$value_color[input$Series=="SE.PRM.INPT.1.U"]` \\\cdashline{2-4}
                                              & Basic Infrastructure     & `r input$value_color[input$Series=="SE.PRM.INFR.1.R"]` & `r input$value_color[input$Series=="SE.PRM.INFR.1.U"]` \\\cdashline{1-4}
\multirow{2}{*}{Learners}   & Capacity for Learning    & {`r input$value_color[input$Series=="SE.PRM.LCAP.1.R"]`\%} & {`r input$value_color[input$Series=="SE.PRM.LCAP.1.U"]`\%} \\\cdashline{2-4}
                            & Student Attendance       & {`r input$value_color[input$Series=="SE.PRM.ATTD.1.R"]`\%} & {`r input$value_color[input$Series=="SE.PRM.ATTD.1.U"]`\%} \\\cdashline{1-4}
\multirow{4}{2cm}{School Management}  & Operational Management   & `r input$value_color[input$Series=="SE.PRM.OPMN.1.R"]` & `r input$value_color[input$Series=="SE.PRM.OPMN.1.U"]` \\\cdashline{2-4}
                                      & Instructional Leadership & `r input$value_color[input$Series=="SE.PRM.ILDR.1.R"]` & `r input$value_color[input$Series=="SE.PRM.ILDR.1.U"]` \\\cdashline{2-4}
                                      & School Knowledge         & `r input$value_color[input$Series=="SE.PRM.PKNW.1.R"]` & `r input$value_color[input$Series=="SE.PRM.PKNW.1.U"]` \\\cdashline{2-4}
                                      & Management Practices     & `r input$value_color[input$Series=="SE.PRM.PMAN.1.R"]` & `r input$value_color[input$Series=="SE.PRM.PMAN.1.U"]`\\\hline
\end{tabular}}
\end{table}
```{r learning, fig.width=5, fig.height=2, echo=FALSE, warning=FALSE}

lp_figure <-   learning_poverty_df %>%
    ggplot(aes(x=grx, y= tab)) +
    geom_point(pch = 21, aes(fill= grx), size = 2) +
    scale_fill_gradient(low = "grey21", high = "grey100") +
    geom_point(data = learning_poverty_df[learning_poverty_df$ID ==country,], aes(x = grx, y=tab), 
               pch=21, color = "black", fill = "#ffffb3", size = 3.5) +
    geom_point(data = learning_poverty_df[learning_poverty_df$ID ==region_label,], aes(x = grx, y=tab), 
               pch=21, color = "black", fill = "#0066ff", size = 3.5) +
    geom_point(data = learning_poverty_df[learning_poverty_df$ID ==income_label,], aes(x = grx, y=tab), 
               pch=21, color = "black", fill = "#ff9933", size = 3.5) +
    #scale_x_continuous(breaks = c(0,0.25,0.5,0.75,1), labels = percent) +
    geom_text_repel(data = subset(learning_poverty_df, !is.na(ID)), aes(x = grx, y = tab, label = ID, color = ID), 
                    fontface = 'bold', size = 3.5, box.padding = 2, segment.color = 'black', ylim = c(0,NA), force = 1) +
    scale_colour_manual(values = c("#282828", "#0066ff", "#ff9933")) +
    ylim(-0.2,0.2)+
    annotate("text", x = c(0,0.25,0.5,0.75,1), y = -0.06, label = c("0%", "25%", "50%", "75%", "100%")) +
    theme_void() +
    theme(legend.position = "none")

lp_num_country <- round(input$value[input$Series=="SE.LPV.PRIM"], digits = 0)
lp_region <- round(learning_poverty_df$`SE.LPV.PRIM`[learning_poverty_df$country == region_label], digits = 0)
lp_category <- round(learning_poverty_df$SE.LPV.PRIM[learning_poverty_df$country == income_label], digits = 0)
diff_lp_regionval <- if_else(lp_num_country>lp_region, lp_num_country-lp_region, lp_region-lp_num_country)
diff_lp_regionval_vf <- diff_lp_regionval[1]
diff_lp_regiontext <- if_else(lp_num_country>lp_region, glue("{diff_lp_regionval_vf}% points worse"), glue("{diff_lp_regionval_vf}% points better"))
diff_lp_catval <- if_else(lp_num_country>lp_category, lp_num_country-lp_category, lp_region-lp_category)
diff_lp_catval_vf <- diff_lp_catval[1]
diff_lp_cattext <- if_else(lp_num_country>lp_category, glue("{diff_lp_catval_vf}% points worse"), glue("{diff_lp_catval_vf}% points better"))

learning_poverty_str <- str_c(lp_num_country, "%", sep = "")

grade4_rural <- round(input$value[input$Series=="SE.PRM.LERN.1.R"], digits = 1)
grade4_urban <- round(input$value[input$Series=="SE.PRM.LERN.1.U"], digits = 1)
diff_lern_rururb <- if_else(grade4_urban>grade4_rural, grade4_urban-grade4_rural, grade4_rural-grade4_urban)
lern_rururb_text <- if_else(grade4_urban>grade4_rural,glue("{diff_lern_rururb} points higher"), glue("{diff_lern_rururb} points lower"))

grade4_male <- round(input$value[input$Series=="SE.PRM.LERN.1.M"], digits = 1)
grade4_female <- round(input$value[input$Series=="SE.PRM.LERN.1.F"], digits = 1)
diff_lern_gender <- if_else(grade4_male>grade4_female, grade4_male-grade4_female, grade4_female-grade4_male)
lern_gender_text <- if_else(grade4_male>grade4_female, glue("{diff_lern_gender} points higher"), glue("{diff_lern_gender} points lower"))

grade4_lit <- round(input$value[input$Series=="SE.PRM.LERN.2"], digits = 0)
grade4_num <- round(input$value[input$Series=="SE.PRM.LERN.3"], digits = 0)
diff_lern_subject <- if_else(grade4_lit>grade4_num, grade4_lit-grade4_num, grade4_num-grade4_lit)
lern_subject_text <- if_else(grade4_lit>grade4_num, glue("{diff_lern_subject} points higher"), glue("{diff_lern_subject} points lower"))
```
### **OVERALL LEARNING OUTCOMES: `r learning_poverty_str` LEARNING POVERTY IN GRADE 4** ###  
Learning poverty is `r diff_lp_regiontext` than the average for `r learning_poverty_df$country[learning_poverty_df$country == region_label]` region and `r diff_lp_cattext` than the average for `r learning_poverty_df$country[learning_poverty_df$country == income_label]` countries.


#### Figure 2. Leaning poverty, `r country` ####
```{r lp_fig, fig.width=5, fig.height=2, message=FALSE, echo=FALSE, warning=FALSE}
lp_figure
```

Average proficiency in Grade 4 is `r lern_subject_text` in literacy compared to numeracy,`r lern_gender_text` for boys compared to girls, and `r lern_rururb_text` in urban areas compared to rural areas.

#### Figure 3. Grade 4 proficiency, `r country` ####
```{r lern_teach, fig.width=5, fig.height=2, message=FALSE, echo=FALSE, warning=FALSE}
input %>%
  filter(Series == "SE.PRM.LERN.1.U"| Series =="SE.PRM.LERN.1.R"|Series =="SE.PRM.LERN.1.M"|Series == "SE.PRM.LERN.1.F"
         |Series == "SE.PRM.LERN.2"|Series =="SE.PRM.LERN.3") %>%
  mutate(gr = c("rural","rural", "gender", "gender", "subject", "subject")) %>%
  ggplot(aes(y=value, x = Series, fill = gr)) +
  geom_bar(stat = "identity", ) +
  geom_text(aes(label= str_c((round(value, digits =1)),"%", sep = "")),hjust=-0.25, size=4) +
  coord_flip()+
  labs(y = "Average Grade 4 proficiency %",
       caption = "Note: Proficiency means % students with knowledge score above 80%") +
  scale_x_discrete(labels = c("Urban", "Rural", "Male", "Female", "Literacy", "Numeracy"), name = "") +
  scale_fill_manual(values=c("#009FDA","#000000","#002244"))+
  scale_y_continuous(limits = c(0,100)) +
  theme_bw() +
  theme(legend.position = "none",
        axis.text.y =  element_text(size = 11),
        axis.title.x = element_text(size = 11))

#Content_knowledge
teach_cont <- round(input$value[input$Series=="SE.PRM.CONT"], digits = 0)
teach_cont_lit <- round(input$value[input$Series=="SE.PRM.CONT.2"], digits = 0)
teach_cont_math <- round(input$value[input$Series=="SE.PRM.CONT.3"], digits = 0)
cont_text <- if_else(teach_cont<60, glue("({teach_cont}%) needs improvement"), if_else(teach_cont>=60 & teach_cont<80, glue("({teach_cont}%) requires caution"), glue("({teach_cont}%) is on target")))
cont_diff_subject <- if_else(teach_cont_lit>teach_cont_math, teach_cont_lit-teach_cont_math, teach_cont_math-teach_cont_lit)
cont_subject_text <- if_else(teach_cont_lit>teach_cont_math, glue("{cont_diff_subject} points higher"), glue("{cont_diff_subject} points lower"))

cont_policy_lowest_var <- as.name(c("SE.PRM.TATT","SE.PRM.TSDP","SE.PRM.TSUP","SE.PRM.TEVL") [which.min(c(input$value[input$Series=="SE.PRM.TATT"], input$value[input$Series=="SE.PRM.TSDP"],input$value[input$Series=="SE.PRM.TSUP"],  input$value[input$Series=="SE.PRM.TEVL"]))])
cont_policy_lowest_varval <- round(input$value[input$Series==cont_policy_lowest_var], digits = 1)

teach_pedg <- round(input$value[input$Series=="SE.PRM.PEDG"], digits = 0)
pedg_text <- if_else(teach_pedg<60, glue("({teach_pedg}%) needs improvement"), if_else(teach_pedg>=60 & teach_pedg<80, glue("({teach_pedg}%) requires caution"), glue("({teach_pedg}%) is on target")))
```

**Teacher effectiveness**  
Teacher content knowledge `r cont_text`. Teacher proficiency in language (`r teach_cont_lit`%) is `r cont_subject_text` than mathematics proficiency (`r teach_cont_math`%). Teacher pedagogical skills score `r pedg_text`.

\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{m{3.8cm}cm{4.2cm}c}
\multicolumn{2}{c}{\textbf{Practice Indicators}} & \multicolumn{2}{c}{\textbf{Policy lever indicators}}\\\hline
Content knowledge                   & {`r input$value_color[input$Series=="SE.PRM.CONT"]`\%}   & Attraction                                & `r input$value_color[input$Series=="SE.PRM.TATT"]` \\\cdashline{1-4} 
\tabindent\emph{Maths proficiency}               & {`r input$value_color[input$Series=="SE.PRM.CONT.3"]`\%} &                                           & `r input$only_color[input$Series=="SE.PRM.TSDP"]`\\\cdashline{1-2}   
\tabindent\emph{Language proficiency}            & {`r input$value_color[input$Series=="SE.PRM.CONT.2"]`\%} & \multirow{-2}{*}{Selection \& deployment} & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.TSDP"]`} \\\cdashline{1-4}        
Pedagogical skills                               & {`r input$value_color[input$Series=="SE.PRM.PEDG"]`\%}   &                                           & `r input$only_color[input$Series=="SE.PRM.TSUP"]`\\\cdashline{1-2}
\tabindent\emph{\% Classroom culture}            & {`r input$value_color[input$Series=="SE.PRM.PEDG.2"]`\%} & \multirow{-2}{*}{Support}                 & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.TSUP"]`} \\\cdashline{1-4}
\tabindent\emph{\% Instruction practices}        & {`r input$value_color[input$Series=="SE.PRM.PEDG.3"]`\%} &                                           & `r input$only_color[input$Series=="SE.PRM.TEVL"]`\\\cdashline{1-2}
\tabindent\emph{\% Socio-emotional skills}       & {`r input$value_color[input$Series=="SE.PRM.PEDG.4"]`\%} & \multirow{-2}{*}{Evaluation}              & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.TEVL"]`} \\\cdashline{1-4}
& `r input$only_color[input$Series=="SE.PRM.EFFT.2"]` & Monitoring \& Accountability  & `r input$value_color[input$Series=="SE.PRM.TMNA"]` \\\cdashline{3-4}
\multirow{-2}{*}{Teacher Attendance}             & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.EFFT.2"]`\%} & Intrinsic motivation    & `r input$value_color[input$Series=="SE.PRM.TINM"]` \\\hline
\end{tabular}}
\\
\greynote{Content knowledge(\& sub-indicators) indicate \% teachers with knowledge\textgreater{80\%}.Pedagogical skills(\& sub-indicators) indicate \% teachers with proficiency 3/5 or above.}
\end{table}
\raggedbottom

```{r lcap_content, message=FALSE, echo=FALSE, warning=FALSE}
#Capacity for learning
lcap <- round(input$value[input$Series=="SE.PRM.LCAP"], digits = 0)
lcap_text <- if_else(lcap<60, glue("({lcap}%) needs improvement"), if_else(lcap>=60 & lcap<80, glue("({lcap}%) requires caution"), glue("({lcap}%) is on target")))
lcap_lowest_var <- as.name(c("SE.PRM.LCAP.2","SE.PRM.LCAP.3","SE.PRM.LCAP.4","SE.PRM.LCAP.5") [which.min(c(input$value[input$Series=="SE.PRM.LCAP.2"], input$value[input$Series=="SE.PRM.LCAP.3"],input$value[input$Series=="SE.PRM.LCAP.4"],  input$value[input$Series=="SE.PRM.LCAP.5"]))])
lcap_lowest_var_name <- input$label[input$Series==lcap_lowest_var]
lcap_lowest_varval <- round(input$value[input$Series==lcap_lowest_var], digits = 1)
lcap_subject_text <- glue("({lcap_lowest_varval}%)")

attd <- round(input$value[input$Series=="SE.PRM.ATTD"], digits = 0)
attd_text <- if_else(attd<60, glue("({attd}%) needs improvement"), if_else(attd>=60 & attd<80, glue("({attd}%) requires caution"), glue("({attd}%) is on target")))
```
**Capacity for learning**  
Student proficiency in Grade 1 `r lcap_text`. `r lcap_lowest_var_name` is the lowest knoweldge sub-score `r lcap_subject_text`. Student attendance`r attd_text`.

\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{m{3.8cm}cm{4.2cm}c}
\multicolumn{2}{c}{\textbf{Practice Indicators}} & \multicolumn{2}{c}{\textbf{Policy lever indicators}}\\\hline
Capacity for learning                  & {`r input$value_color[input$Series=="SE.PRM.LCAP"]`\%} & & `r input$only_color[input$Series=="SE.PRM.LNTN"]`\\\cdashline{1-2}
\tabindent\emph{Numeracy score}        & `r input$value_color[input$Series=="SE.PRM.LCAP.2"]`   & \multirow{-2}{*}{Nutrition Programs} & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.LNTN"]`}  \\\cdashline{1-4}  
\tabindent\emph{Literacy score}        & `r input$value_color[input$Series=="SE.PRM.LCAP.3"]`   & Health Programs                     & `r input$value_color[input$Series=="SE.PRM.LHTH"]` \\\cdashline{1-4}  
\tabindent\emph{Executive score}       & `r input$value_color[input$Series=="SE.PRM.LCAP.4"]`   & Center based care                   & `r input$value_color[input$Series=="SE.PRM.LCBC"]` \\\cdashline{1-4}  
\tabindent\emph{Socio-emotional score} & `r input$value_color[input$Series=="SE.PRM.LCAP.5"]`   & Caregiver Skills Capacity           & `r input$value_color[input$Series=="SE.PRM.LSKC"]` \\\cdashline{1-4}  
Student Attendance                     & {`r input$value_color[input$Series=="SE.PRM.ATTD"]`\%}     & Caregiver Financial Capacity        & `r input$value_color[input$Series=="SE.PRM.LFCP"]` \\\hline
\end{tabular}}
\\
\greynote{Capacity for learning indicates \% students with knowledge\textgreater{80\%}. Sub-indicator scores refer to average subject knowledge on a 0-100 scale.}
\end{table}
\raggedbottom
```{r inputs_content, echo=FALSE, message=FALSE, warning=FALSE}
#Inputs and infrastructure
inpt <- round(input$value[input$Series=="SE.PRM.INPT"], digits = 0)
inpt_text <- if_else(inpt<3, glue("({inpt}/5) need improvement"), if_else(lcap>=3 & lcap<4, glue("({inpt}/5) require caution"), glue("({inpt}/5) are on target")))
inpt_lowest_var <- as.name(c("SE.PRM.INPT.2","SE.PRM.INPT.3","SE.PRM.INPT.4","SE.PRM.INPT.5") [which.min(c(input$value[input$Series=="SE.PRM.INPT.2"], input$value[input$Series=="SE.PRM.INPT.3"],input$value[input$Series=="SE.PRM.INPT.4"],  input$value[input$Series=="SE.PRM.INPT.5"]))])
inpt_lowest_var_name <- input$label[input$Series==inpt_lowest_var]
inpt_lowest_varval <- round(input$value[input$Series==inpt_lowest_var], digits = 1)
inpt_component_text <- glue("({inpt_lowest_varval}%)")

infr <- round(input$value[input$Series=="SE.PRM.INFR"], digits = 0)
infr_text <- if_else(infr<3, glue("({infr}/5) needs improvement"), if_else(infr>=3 & infr<4, glue("({infr}/5) requires caution"), glue("({infr}/5) is on target")))
infr_lowest_var <- as.name(c("SE.PRM.INFR.2","SE.PRM.INFR.3","SE.PRM.INFR.4","SE.PRM.INFR.5","SE.PRM.INFR.6") [which.min(c(input$value[input$Series=="SE.PRM.INFR.2"], input$value[input$Series=="SE.PRM.INFR.3"],input$value[input$Series=="SE.PRM.INFR.4"],  input$value[input$Series=="SE.PRM.INFR.5"], input$value[input$Series=="SE.PRM.INFR.6"]))])
infr_lowest_var_name <- input$label[input$Series==infr_lowest_var]
infr_lowest_varval <- round(input$value[input$Series==infr_lowest_var], digits = 1)
infr_component_text <- glue("({infr_lowest_varval}%)")
```
**Inputs and infrastructure**  
Basic inputs `r inpt_text`. `r inpt_lowest_var_name` is the lowest score `r inpt_component_text`. Basic infrastructure `r infr_text`. `r infr_lowest_var_name` is the lowest score `r infr_component_text`.

\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{m{3.8cm}cm{4.2cm}c}
\multicolumn{2}{c}{\textbf{Practice Indicators}} & \multicolumn{2}{c}{\textbf{Policy lever indicators}}\\\hline
Basic inputs & `r input$value_color[input$Series=="SE.PRM.INPT"]` & & `r input$only_color[input$Series=="SE.PRM.ISTD"]` \\\cdashline{1-2}
\tabindent\emph{\% Blackboard}    & {`r input$value_color[input$Series=="SE.PRM.INPT.2"]`\%} & & `r input$only_color[input$Series=="SE.PRM.ISTD"]`\\\cdashline{1-2}
\tabindent\emph{\% Stationery}    & {`r input$value_color[input$Series=="SE.PRM.INPT.3"]`\%} & & `r input$only_color[input$Series=="SE.PRM.ISTD"]`\\\cdashline{1-2}
\tabindent\emph{\% Furniture}     & {`r input$value_color[input$Series=="SE.PRM.INPT.4"]`\%} & & `r input$only_color[input$Series=="SE.PRM.ISTD"]`\\\cdashline{1-2}
\tabindent\emph{\% EdTech access} & {`r input$value_color[input$Series=="SE.PRM.INPT.5"]`\%} & \multirow{-5}{4.2cm}{Inputs and infrastructure standards} & \multirow{-5}{*}{`r input$value_color[input$Series=="SE.PRM.ISTD"]`}\\\hline
Basic infrastructure & `r input$value_color[input$Series=="SE.PRM.INFR"]` & & `r input$only_color[input$Series=="SE.PRM.IMON"]` \\\cdashline{1-2}
\tabindent\emph{\% Drinking water}    & {`r input$value_color[input$Series=="SE.PRM.INFR.2"]`\%} & & `r input$only_color[input$Series=="SE.PRM.IMON"]`\\\cdashline{1-2}
\tabindent\emph{\% Functional toilet} & {`r input$value_color[input$Series=="SE.PRM.INFR.3"]`\%} & & `r input$only_color[input$Series=="SE.PRM.IMON"]`\\\cdashline{1-2}
\tabindent\emph{\% Internet}          & {`r input$value_color[input$Series=="SE.PRM.INFR.4"]`\%} & & `r input$only_color[input$Series=="SE.PRM.IMON"]`\\\cdashline{1-2}
\tabindent\emph{\% Electricity}       & {`r input$value_color[input$Series=="SE.PRM.INFR.5"]`\%} & & `r input$only_color[input$Series=="SE.PRM.IMON"]`\\\cdashline{1-2}
\tabindent\emph{\% Disability access} & {`r input$value_color[input$Series=="SE.PRM.INFR.6"]`\%} & \multirow{-6}{4.2cm}{Inputs and infrastructure monitoring} & \multirow{-6}{*}{`r input$value_color[input$Series=="SE.PRM.IMON"]`}\\\hline
\end{tabular}}
\\
\greynote{\% refers to \% schools with the given sub-component}
\end{table}
\raggedbottom
```{r manage_content, echo=FALSE, message=FALSE, warning=FALSE}
#Inputs and infrastructure
manage_lowest_var <- as.name(c("SE.PRM.OPMN","SE.PRM.ILDR","SE.PRM.PKNW","SE.PRM.PMAN") [which.min(c(input$value[input$Series=="SE.PRM.OPMN"], input$value[input$Series=="SE.PRM.ILDR"],input$value[input$Series=="SE.PRM.PKNW"],  input$value[input$Series=="SE.PRM.PMAN"]))])
manage_lowest_var_name <- input$Indicator.Name[input$Series==manage_lowest_var]
manage_lowest_varval <- round(input$value[input$Series==manage_lowest_var], digits = 1)
manage_lcomponent_text <- glue("({manage_lowest_varval}/5)")

manage_highest_var <- as.name(c("SE.PRM.OPMN","SE.PRM.ILDR","SE.PRM.PKNW","SE.PRM.PMAN") [which.max(c(input$value[input$Series=="SE.PRM.OPMN"], input$value[input$Series=="SE.PRM.ILDR"],input$value[input$Series=="SE.PRM.PKNW"],  input$value[input$Series=="SE.PRM.PMAN"]))])
manage_highest_var_name <- input$Indicator.Name[input$Series==manage_highest_var]
manage_highest_varval <- round(input$value[input$Series==manage_highest_var], digits = 1)
manage_hcomponent_text <- glue("({manage_highest_varval}/5)")

manage_sub_ind <- c("SE.PRM.OPMN", "SE.PRM.OPMN.2", "SE.PRM.OPMN.3", "SE.PRM.ILDR", "SE.PRM.ILDR.2", "SE.PRM.ILDR.3", "SE.PRM.ILDR.4", "SE.PRM.ILDR.5", "SE.PRM.ILDR.6", "SE.PRM.ILDR.7", "SE.PRM.ILDR.8","SE.PRM.PKNW","SE.PRM.PKNW.2","SE.PRM.PKNW.3",
"SE.PRM.PMAN", "SE.PRM.PMAN.2","SE.PRM.PMAN.3")
lowest_sub_ind <- grep(manage_lowest_var, manage_sub_ind, value=TRUE)
```
**School Management by principals**  
In school management, the lowest score is for principal's `r manage_lowest_var_name``r manage_lcomponent_text`, whereas the highest score is obtained for `r manage_highest_var_name``r manage_hcomponent_text`

\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{m{4.8cm}cm{4cm}c}
\multicolumn{2}{c}{\textbf{Practice Indicators}} & \multicolumn{2}{c}{\textbf{Policy lever indicators}}\\\hline
Operational management                     & `r input$value_color[input$Series=="SE.PRM.OPMN"]`       & & `r input$only_color[input$Series=="SE.PRM.SCFN"]`\\\cdashline{1-2}
\tabindent\emph{Infrastructure}            & `r input$value_color[input$Series=="SE.PRM.OPMN.2"]`     & & `r input$only_color[input$Series=="SE.PRM.SCFN"]`\\\cdashline{1-2}
\tabindent\emph{Ensuring inputs}           & `r input$value_color[input$Series=="SE.PRM.OPMN.3"]`     & & `r input$only_color[input$Series=="SE.PRM.SCFN"]`\\\cdashline{1-2}
Instructional Leadership                   & `r input$value_color[input$Series=="SE.PRM.ILDR"]`       & & `r input$only_color[input$Series=="SE.PRM.SCFN"]`\\\cdashline{1-2}
\tabindent\emph{\% Classroom observed}     & {`r input$value_color[input$Series=="SE.PRM.ILDR.2"]`\%} & & `r input$only_color[input$Series=="SE.PRM.SCFN"]`\\\cdashline{1-2}
\tabindent\emph{\% Discussed observations} & {`r input$value_color[input$Series=="SE.PRM.ILDR.4"]`\%} & & `r input$only_color[input$Series=="SE.PRM.SCFN"]`\\\cdashline{1-2}
\tabindent\emph{\% Feedback given}         & {`r input$value_color[input$Series=="SE.PRM.ILDR.6"]`\%} & & `r input$only_color[input$Series=="SE.PRM.SCFN"]`\\\cdashline{1-2}
\tabindent\emph{\% Lesson-plan feedback}   & {`r input$value_color[input$Series=="SE.PRM.ILDR.8"]`\%} & \multirow{-8}{*}{Clarity of functions} & \multirow{-8}{*}{`r input$value_color[input$Series=="SE.PRM.SCFN"]`} \\\hline
Principal school knowledge                         & `r input$value_color[input$Series=="SE.PRM.PKNW"]`       & & `r input$only_color[input$Series=="SE.PRM.SATT"]`\\\cdashline{1-2}
\tabindent\emph{\% Familiarity-teacher knowledge}  & {`r input$value_color[input$Series=="SE.PRM.PKNW.2"]`\%} & \multirow{-2}{4cm}{Attraction} & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.SATT"]`}\\\cdashline{1-4}
\tabindent\emph{\% Familiarity-teacher experience} & {`r input$value_color[input$Series=="SE.PRM.PKNW.3"]`\%} & & `r input$only_color[input$Series=="SE.PRM.SSLD"]`\\\cdashline{1-2}
\tabindent\emph{\% Familiarity-school inputs}      & {`r input$value_color[input$Series=="SE.PRM.PKNW.4"]`\%} & \multirow{-2}{4cm}{Selection \& Deployment} & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.SSLD"]`} \\\cdashline{1-4} 
Management skills & `r input$value_color[input$Series=="SE.PRM.PMAN"]` & & `r input$value_color[input$Series=="SE.PRM.SSUP"]`\\\cdashline{1-2}
\tabindent\emph{Problem solving} & `r input$value_color[input$Series=="SE.PRM.PMAN.2"]` & \multirow{-2}{4cm}{Support} & \multirow{-2}{*}{`r input$value_color[input$Series=="SE.PRM.SSUP"]`}\\\cdashline{1-4}
\tabindent\emph{Goal-setting} & `r input$value_color[input$Series=="SE.PRM.PMAN.3"]` & Evaluation & `r input$value_color[input$Series=="SE.PRM.SEVL"]`\\\hline
\end{tabular}}
\\
\greynote{\% refers to \% schools with the given sub-component}
\end{table}
\raggedbottom
```{r defacto_data, echo=FALSE, message=FALSE, warning=FALSE}
#Putting table in
defac_jure_ind_list <- c("SE.PRM.SATT",
  "SE.PRM.SATT.DJ",
  "SE.PRM.SCFN",
  "SE.PRM.SCFN.DJ",
  "SE.PRM.SEVL",
  "SE.PRM.SEVL.DJ",
  "SE.PRM.SSLD",
  "SE.PRM.SSLD.DJ",
  "SE.PRM.SSUP",
  "SE.PRM.SSUP.DJ",
  "SE.PRM.TATT",
  "SE.PRM.TATT.DJ",
  "SE.PRM.TEVL",
  "SE.PRM.TEVL.DJ",
  "SE.PRM.TINM",
  "SE.PRM.TINM.DJ",
  "SE.PRM.TMNA",
  "SE.PRM.TMNA.DJ",
  "SE.PRM.TSDP",
  "SE.PRM.TSDP.DJ",
  "SE.PRM.TSUP",
  "SE.PRM.TSUP.DJ"
)
  defacto_master_tbl <- input %>%
    filter (Series %in%  defac_jure_ind_list) %>%
    mutate(type = case_when(grepl('\\.DJ$', Series) ~ "De-jure", 
                            TRUE ~"De-facto"))
defacto_diff <- defacto_master_tbl %>%
    select(label, type, value) %>%
    spread(type,value) %>%
    mutate(diff=`De-jure`-`De-facto`) %>%
    arrange(desc(diff))
average_diff <- round(mean(defacto_diff$diff), digits=1)
#Finding top 3 indicators with highest difference and writing down their differences
high_diff_var_text <- glue("{defacto_diff[1,1]} ({defacto_diff[1,4]} points)")
sechigh_diff_var_text <- glue("{defacto_diff[2,1]} ({defacto_diff[2,4]} points)")
thirdhigh_diff_var_text <- glue("{defacto_diff[3,1]} ({defacto_diff[3,4]} points)")
```
### **GAPS BETWEEN DE-FACTO INDICATORS AND DE-JURE POICIES IN TEACHING AND SCHOOL MANAGEMENT** ###    
A ~`r average_diff` point average gap exists between the de-facto indicators and de-jure policies in `r country` across teaching and school management.

#### Figure 4. De-facto and de-jure indicators for policy levers, `r country` ####
```{r defacto_graphs, fig.width=5, fig.height=5, echo=FALSE, message=FALSE, warning=FALSE}
#Main De-facto De-jure graph
defacto_master_tbl %>%
    ggplot(aes(x=label, y=value, color = type))+
    geom_point(size = 3) + 
    geom_line(aes(x=label, y=value, group = label, colour="#000099"),show.legend=FALSE) +
    scale_color_manual(breaks = c("De-facto","De-jure"),
                       values = c("grey3","#24527c","#ed3833"))+
    coord_flip() + 
    scale_x_discrete(labels=function(x) str_wrap(x,width=30)) +
    labs(fill="Type of indicator")+
    ylim(0,5)+
    labs(x= "Policy Lever Indicators",
         y = "Scale (1-5)",
         color = "Type of score",
         caption = "Note: De-facto indicators are observed in practice, de-jure indicators are set in policy")+
    theme_bw() +
    theme(legend.position = "bottom",
          plot.title = element_text(hjust = 1),
          axis.text.x = element_text(size = 11),
          axis.text.y = element_text(size = 11))

  defacto_subind_list<- c(
    "SE.PRM.SATT.2",
    "SE.PRM.SATT.3",
    "SE.PRM.SCFN.1",
    "SE.PRM.SCFN.11",
    "SE.PRM.SCFN.13",
    "SE.PRM.SCFN.3",
    "SE.PRM.SCFN.5",
    "SE.PRM.SCFN.7",
    "SE.PRM.SCFN.9",
    "SE.PRM.SEVL.3",
    "SE.PRM.SEVL.4",
    "SE.PRM.SEVL.5",
    "SE.PRM.SEVL.6",
    "SE.PRM.SSLD.13",
    "SE.PRM.SSLD.14",
    "SE.PRM.SSLD.15",
    "SE.PRM.SSLD.6",
    "SE.PRM.SSLD.7",
    "SE.PRM.SSLD.8",
    "SE.PRM.SSUP.10",
    "SE.PRM.SSUP.6",
    "SE.PRM.SSUP.8",
    "SE.PRM.SSUP.9",
    "SE.PRM.TATT.2",
    "SE.PRM.TATT.3",
    "SE.PRM.TATT.4",
    "SE.PRM.TATT.5",
    "SE.PRM.TATT.6",
    "SE.PRM.TATT.8",
    "SE.PRM.TEVL.3",
    "SE.PRM.TEVL.6",
    "SE.PRM.TEVL.7",
    "SE.PRM.TMNA.3",
    "SE.PRM.TMNA.4",
    "SE.PRM.TMNA.5",
    "SE.PRM.TSDP.2",
    "SE.PRM.TSDP.4",
    "SE.PRM.TSDP.6",
    "SE.PRM.TSUP.2",
    "SE.PRM.TSUP.3",
    "SE.PRM.TSUP.5",
    "SE.PRM.TSUP.8",
    "SE.PRM.TSUP.9"
  )
  
  tinm_new_series <- c("SE.PRM.TINM.new.a",
                       "SE.PRM.TINM.new.b",
                       "SE.PRM.TINM.new.c",
                       "SE.PRM.TINM.new.d",
                       "SE.PRM.TINM.new.e",
                       "SE.PRM.TINM.new.f"
  )
  
  tinm_new_label <- c("Have high tolerance for teacher absence",
                      "Believe students can change intelligence",
                      "Believe students cannot change their intelligence",
                      "Have intrinsic motivation for career",
                      "Report compulsory probation period",
                      "Believe students deserve more attention if they put in work")
  
  tinm_new_val1 <- round(mean(c(input$value[input$Series == "SE.PRM.TINM.1"],
                                input$value[input$Series == "SE.PRM.TINM.2"],
                                input$value[input$Series == "SE.PRM.TINM.3"]), na.rm= TRUE), digits =1)
  tinm_new_val2 <- round(mean(c(input$value[input$Series == "SE.PRM.TINM.9"],
                                input$value[input$Series == "SE.PRM.TINM.10"]), na.rm= TRUE), digits =1)
  tinm_new_val3 <- round(mean(c(input$value[input$Series == "SE.PRM.TINM.7"],
                                input$value[input$Series == "SE.PRM.TINM.8"]), na.rm= TRUE), digits =1)
  tinm_new_val4 <- round(input$value[input$Series == "SE.PRM.TINM.11"], digits =1)
  tinm_new_val5 <- round(input$value[input$Series == "SE.PRM.TINM.12"], digits=1)
  tinm_new_val6 <- round(mean(c(input$value[input$Series == "SE.PRM.TINM.4"],
                                input$value[input$Series == "SE.PRM.TINM.5"],
                                input$value[input$Series == "SE.PRM.TINM.6"]), na.rm= TRUE), digits=1)
  
  tinm_new_val <- c(
    tinm_new_val1,
    tinm_new_val2,
    tinm_new_val3,
    tinm_new_val4,
    tinm_new_val5,
    tinm_new_val6
  )
  
  defacto_subind_final <- input %>%
    filter(Series %in% defacto_subind_list) %>%
    select(Series,label,value) %>%
    add_row(Series = tinm_new_series, label = tinm_new_label, value = tinm_new_val) %>%
    mutate(value = as.numeric(value))
  
  defacto_sub_plotfn <- function(dt, var, title) {
    ggplot(data= subset(dt, grepl(var, Series)), aes(x=label,y=value)) +
      geom_bar(stat="identity", fill= "#002244") +
      geom_text(aes(label= str_c((round(value, digits =1)),"%", sep = "")),hjust=-0.25, size=4) +
      coord_flip()+
      scale_x_discrete(labels=function(x) str_wrap(x,width=30)) +
      scale_y_continuous(limits = c(0,120), breaks = c(0,25,50,75,100)) +
      xlab(str_wrap(glue("Sub-indicators"), width=20))+
      ylab("Scale (0-100%)") +
      theme_bw() +
      theme(legend.position = "none",
            plot.title = element_text(hjust = 1),
            axis.text.x = element_text(size = 11),
            axis.text.y = element_text(size = 9),
            plot.caption.position = "plot")
  }
  SE.PRM.TSUP_plot <- defacto_sub_plotfn(defacto_subind_final, "TSUP")
  SE.PRM.SCFN_plot <- defacto_sub_plotfn(defacto_subind_final, "SCFN")
  SE.PRM.SEVL_plot <- defacto_sub_plotfn(defacto_subind_final, "SEVL")
  SE.PRM.SSLD_plot <- defacto_sub_plotfn(defacto_subind_final, "SSLD")
  SE.PRM.SSUP_plot <- defacto_sub_plotfn(defacto_subind_final, "SSUP")
  SE.PRM.TATT_plot <- defacto_sub_plotfn(defacto_subind_final, "TATT")
  SE.PRM.TEVL_plot <- defacto_sub_plotfn(defacto_subind_final, "TEVL")
  SE.PRM.TINM_plot <- defacto_sub_plotfn(defacto_subind_final, "TINM")
  SE.PRM.TMNA_plot <- defacto_sub_plotfn(defacto_subind_final, "TMNA")
  
  SE.PRM.SATT_plot_1 <- ggplot(data= subset(defacto_subind_final, grepl('SATT.2', Series)), aes(x=label,y=value)) +
      geom_bar(stat="identity", fill= "#002244") +
      geom_text(aes(label= round(value, digits =1),hjust=-0.25, size=4)) +
      scale_y_continuous(limits = c(0,5), breaks = c(1,2,3,4,5)) +
      ylab("Scale (0-5)")
  
  SE.PRM.SATT_plot_2 <- ggplot(data= subset(defacto_subind_final, grepl('SATT.3', Series)), aes(x=label,y=value)) +
    geom_bar(stat="identity", fill= "#009FDA") +
    geom_text(aes(label= str_c((round(value, digits =1)),"%", sep = "")),hjust=-0.25, size=4) +
    scale_y_continuous(limits = c(0,110), breaks = c(0,25,50,75,100)) +
    ylab("Scale (0-5)") 
  
  SE.PRM.TSDP_plot_1 <- ggplot(data= subset(defacto_subind_final, grepl('TSDP.4|TSDP.6', Series)), aes(x=label,y=value)) +
    geom_bar(stat="identity", fill= "#002244") +
    geom_text(aes(label= round(value, digits =1),hjust=-0.25, size=4)) +
    scale_y_continuous(limits = c(0,2), breaks = c(0,0.5,1,1.5,2)) +
    ylab("Scale (0-2)")
  
  SE.PRM.TSDP_plot_2 <- ggplot(data= subset(defacto_subind_final, grepl('TSDP.2', Series)), aes(x=label,y=value)) +
    geom_bar(stat="identity", fill= "#009FDA") +
    geom_text(aes(label= str_c((round(value, digits =1)),"%", sep = "")),hjust=-0.25, size=4) +
    scale_y_continuous(limits = c(0,110), breaks = c(0,25,50,75,100)) +
    ylab("Scale (0-2)")
  
  edit_plot <- function(plot) {
    plot + coord_flip()+
           scale_x_discrete(labels=function(x) str_wrap(x,width=30)) +
           xlab(str_wrap(glue("Sub-indicator"), width=20))+
           theme_bw() +
           theme(legend.position = "none",
           plot.title = element_text(hjust = 1),
           axis.text.x = element_text(size = 11),
           axis.text.y = element_text(size = 9))
  }
  
  SE.PRM.SATT_plot <- cowplot::plot_grid(edit_plot(SE.PRM.SATT_plot_1),edit_plot(SE.PRM.SATT_plot_2), align ='v', ncol=1)
  SE.PRM.TSDP_plot <- cowplot::plot_grid(edit_plot(SE.PRM.TSDP_plot_1),edit_plot(SE.PRM.TSDP_plot_2), align ='v', ncol=1)
  
  SE.PRM.TSUP_note <- "Percent of teachers reporting in affirmative unless stated otherwise"
  SE.PRM.SCFN_note <- "Percent of principals who know if policies governing schools assign responsibility for implementation of given school management aspect."
  SE.PRM.SEVL_note <- "Percent of principals reporting on the given evaluation aspect."
  SE.PRM.SSLD_note <- "Percent of principals reporting which factors count in principal selection, or are most important in principal selection."
  SE.PRM.SSUP_note <- "Percent of principals reporting on the given school management support aspect."
  SE.PRM.TATT_note <- "Percent of teachers reporting in affirmative, or 'agree/strongly agree' with given aspect of attraction to teaching."
  SE.PRM.TEVL_note <- "Percent of teachers reporting on the given teacher evaluation aspect."
  SE.PRM.TINM_note <- "(1) Percent of teachers reporting on the given teacher motivation aspect. (2) Tolerance for teacher absence means teacher absence is acceptable if assigned curriculum is complete, students are left with work to do, or if teacher is doing useful community service. (3) Students putting in work means students deserve more attention if they attend school regularly, bring materials to school or have motivation to learn."
  SE.PRM.TMNA_note <- "Percent of teachers reporting on the given teacher monitoring & accountability aspect."

  highest_diff_var <- as.character(defacto_master_tbl$Series[defacto_master_tbl$label==as.character(defacto_diff[1,1]) &
                                                               defacto_master_tbl$type=="De-facto"])
  sechighest_diff_var <- as.character(defacto_master_tbl$Series[defacto_master_tbl$label==as.character(defacto_diff[2,1]) &
                                                                  defacto_master_tbl$type=="De-facto"])
  thirdhighest_diff_var <- as.character(defacto_master_tbl$Series[defacto_master_tbl$label==as.character(defacto_diff[3,1]) &
                                                                    defacto_master_tbl$type=="De-facto"])
plot1 <- eval(parse(text=paste(highest_diff_var,"_plot",sep="")))
plot2 <- eval(parse(text=paste(sechighest_diff_var,"_plot",sep="")))
plot3 <- eval(parse(text=paste(thirdhighest_diff_var,"_plot",sep="")))
plot1_note <- eval(parse(text=paste(highest_diff_var,"_note",sep="")))
plot2_note <- eval(parse(text=paste(sechighest_diff_var,"_note",sep="")))
plot3_note <- eval(parse(text=paste(thirdhighest_diff_var,"_note",sep="")))
```

### **Breakdown of sub-indicators of the top 3 de-facto indicators which differ the most from de-jure indicators** ###  
The highest gaps in practices and policies are observed for `r high_diff_var_text`, `r sechigh_diff_var_text`, `r thirdhigh_diff_var_text`.
\vfill\null

#### Figure 5: Sub-indicators of `r defacto_diff[1,1]` ####
```{r defacto_sub_graphs_1, fig.width=5, fig.height=3, echo=FALSE, message=FALSE, warning=FALSE}
plot1
```

\setstretch{0.8}\color{darkgray}\scriptsize{\textit{Notes:} `r plot1_note`}

#### Figure 6: Sub-indicators of `r defacto_diff[2,1]` ####
```{r defacto_sub_graphs_2, fig.width=5, fig.height=3, echo=FALSE, message=FALSE, warning=FALSE}
plot2
```

\setstretch{0.8}\color{darkgray}\scriptsize{\textit{Notes:} `r plot2_note`}

#### Figure 7: Sub-indicators of `r defacto_diff[3,1]` ####
```{r defacto_sub_graphs_3, fig.width=5, fig.height=3, echo=FALSE, message=FALSE, warning=FALSE}
plot3
```

\setstretch{0.8}\color{darkgray}\scriptsize{\textit{Notes:} `r plot3_note`}

\vfill\null

```{r politics_data, echo=FALSE, message=FALSE, warning=FALSE}

 politics <- input %>%
    filter(Series %in% c("SE.PRM.BFIN",
                         "SE.PRM.BIMP",
                         "SE.PRM.BMAC",
                         "SE.PRM.BNLG",
                         "SE.PRM.BQBR")) %>%
    mutate(category = fct_relevel(label,levels=c("Quality of Bureaucracy",
                                                 "Impartial Decision-Making",
                                                 "Mandates & Accountability",
                                                 "National Learning Goals",
                                                 "Financing")))
politics_highest_var <- as.name(c("SE.PRM.BQBR",
                                  "SE.PRM.BIMP",
                                  "SE.PRM.BMAC",
                                  "SE.PRM.BNLG", 
                                  "SE.PRM.BFIN"
                                  ) [which.max(c(input$value[input$Series=="SE.PRM.BQBR"],
                                                 input$value[input$Series=="SE.PRM.BIMP"],
                                                 input$value[input$Series=="SE.PRM.BMAC"],
                                                 input$value[input$Series=="SE.PRM.BNLG"],
                                                 input$value[input$Series=="SE.PRM.BFIN"]))])
politics_highest_var_name <- input$category[input$Series==politics_highest_var]
politics_highest_varval <- round(input$value[input$Series==politics_highest_var], digits = 1)
politics_highest_text <- glue("({politics_highest_varval}/5)")

politics_lowest_var <- as.name(c("SE.PRM.BQBR",
                                  "SE.PRM.BIMP",
                                  "SE.PRM.BMAC",
                                  "SE.PRM.BNLG", 
                                  "SE.PRM.BFIN"
                                  ) [which.min(c(input$value[input$Series=="SE.PRM.BQBR"],
                                                 input$value[input$Series=="SE.PRM.BIMP"],
                                                 input$value[input$Series=="SE.PRM.BMAC"],
                                                 input$value[input$Series=="SE.PRM.BNLG"],
                                                 input$value[input$Series=="SE.PRM.BFIN"]))])
politics_lowest_var_name <- input$category[input$Series==politics_lowest_var]
politics_lowest_varval <- round(input$value[input$Series==politics_lowest_var], digits = 1)
politics_lowest_text <- glue("({politics_lowest_varval}/5)")
```

### **POLITICS & BUREAUCRATIC CAPACITY INDICATORS** ###  

\singlespacing{The highest score in politics and bureaucratic capacity is noted for `r politics_highest_var_name` `r politics_highest_text`, and the lowest score is noted for `r politics_lowest_var_name` `r politics_lowest_text`.}

#### Figure 8. Politics and bureaucratic capacity indicators, `r country` ####
```{r politics_graph,  fig.width=5, fig.height=3, echo= FALSE, message=FALSE, warning=FALSE}

 politics %>%
    ggplot(aes(x=category, y=value, fill=category))+
    geom_bar(stat="identity", position="dodge") +
    geom_text(aes(label= (round(value, digits = 1)),hjust = -0.3, size=5)) +
    coord_flip()+
    scale_x_discrete(labels=function(x) str_wrap(x,width=30)) +
    scale_y_continuous(limits = c(0,6), breaks = c(1,2,3,4,5)) +
    scale_fill_manual(values= c("#002244","#009FDA","#000000","#006450","#98252B"))+
    xlab("")+
    ylab("Scale(1-5)") +
    theme_bw() +
    theme(legend.position = "none",
          plot.title = element_text(hjust = 1),
          axis.text.x = element_text(size = 11),
          axis.text.y = element_text(size = 9))
```

### Table 4. Politics and bureaucratic capacity sub-indicators, `r country`###

\begin{table}[H]
\resizebox{\columnwidth}{!}{\begin{tabular}{p{7cm}c}
\textbf{Indicator} & \textbf{Value} \\ \hline
\textbf\textit{Quality of bureaucracy (Scale 1-5)} & \\
Knowledge and skills &`r input$value_color[input$Series=='SE.PRM.BQBR.2']` \\\cdashline{1-2}
Work enviornment &`r input$value_color[input$Series=='SE.PRM.BQBR.3']` \\\cdashline{1-2}
Merit &`r input$value_color[input$Series=='SE.PRM.BQBR.4']` \\\cdashline{1-2}
Motivation and attitudes &`r input$value_color[input$Series=='SE.PRM.BQBR.5']` \\\hline
\textbf\textit{Impartial decision making (Scale 1-5)} & \\
Politicized personnel management &`r input$value_color[input$Series=='SE.PRM.BIMP.2']` \\\cdashline{1-2}
Politicized policy-making &`r input$value_color[input$Series=='SE.PRM.BIMP.3']` \\\cdashline{1-2}
Politicized policy implementation &`r input$value_color[input$Series=='SE.PRM.BIMP.4']` \\\cdashline{1-2}
Employee unions as facilitators &`r input$value_color[input$Series=='SE.PRM.BIMP.5']` \\\hline
\textbf\textit{Mandates and accountability (Scale 1-5)} & \\
Coherence &`r input$value_color[input$Series=='SE.PRM.BMAC.2']` \\\cdashline{1-2}
Transparency &`r input$value_color[input$Series=='SE.PRM.BMAC.3']` \\\cdashline{1-2}
Public official accountability &`r input$value_color[input$Series=='SE.PRM.BMAC.4']` \\\hline
\textbf\textit{National learning goals (Scale 1-5)} & \\
Targeting &`r input$value_color[input$Series=='SE.PRM.BNLG.2']` \\\cdashline{1-2}
Monitoring &`r input$value_color[input$Series=='SE.PRM.BNLG.3']` \\\cdashline{1-2}
Incentives &`r input$value_color[input$Series=='SE.PRM.BNLG.4']` \\\cdashline{1-2}
Community engagement &`r input$value_color[input$Series=='SE.PRM.BNLG.5']` \\\hline
\textbf\textit{Financing} & \\
Per child spending adequacy(0-1) &`r input$value[input$Series=='SE.PRM.BFIN.2']` \\\cdashline{1-2}
Public expenditure and financial accountability efficiency (0-1) &`r input$value[input$Series=='SE.PRM.BFIN.3']` \\\cdashline{1-2}
Financing and efficiency outcome (0-1) &`r input$value[input$Series=='SE.PRM.BFIN.4']` \\\cdashline{1-2}
Equity &`r input$value[input$Series=='SE.PRM.BFIN.5']` \\\hline
\end{tabular}}
\end{table}

